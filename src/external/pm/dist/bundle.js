var PMAnalyzer =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./hook.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./Analyzer.js":
/*!*********************!*\
  !*** ./Analyzer.js ***!
  \*********************/
/*! exports provided: analyzeHandler, isNativeFunc */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"analyzeHandler\", function() { return analyzeHandler; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isNativeFunc\", function() { return isNativeFunc; });\n/* harmony import */ var _ForcedRun_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ForcedRun.js */ \"./ForcedRun.js\");\n/* harmony import */ var _evaluationHelper_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./evaluationHelper.js */ \"./evaluationHelper.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util.js */ \"./util.js\");\n/* harmony import */ var _ExploitGenerator_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ExploitGenerator.js */ \"./ExploitGenerator.js\");\n/*\nCopyright (C) 2020  Marius Steffens, CISPA\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n\n\n\n\n\n\n// global mapping from already instrumented functions to their instrumented counterparts\nlet fun_mapping = new Map();\n// selectively enable/disable proxying of document.cookie localStorage values\nlet shouldPrivacyThings = false;\n\n\nfunction checkParamForProxies(e, sinkID, indizes = undefined, manual = false) {\n  let args = e.arguments;\n  if (indizes === undefined) {\n    indizes = args.keys();\n  }\n  for (let i of indizes) {\n    if (args.length > i) {\n      if (args[i] && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(args[i])) {\n        if (!manual)\n          e.instance.ForceExecution.emitSinkAccess(args[i], sinkID, i, e.hash);\n        else\n          e.instance.ForceExecution.emitSinkAccess(args[i], sinkID, i, e.hash, 'manual');\n      }\n    }\n  }\n}\n\nfunction parseCookies() {\n  let c_st = document.cookie;\n  let parsed = {};\n  for (let splitted of c_st.split(';')) {\n    if (splitted.indexOf('=') === -1) {\n      continue\n    }\n    let [key, val] = splitted.split('=');\n    parsed[key.trim()] = val.trim()\n  }\n  return parsed;\n}\n\nfunction extractConstraintFromProxy(p) {\n  let constraint;\n  if (p.__is_real_value) {\n    constraint = {ops: Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(p.__get_ops), value: p.__get_identifier, isRealValue: true, val: p.__get_real_obj};\n  } else {\n    constraint = {ops: Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(p.__get_ops), identifier: p.__get_identifier};\n  }\n  return constraint;\n}\n\nfunction checkForFlowToSink(e) {\n  // references to other windows do not yet work.\n  if (e.call === document.write) {\n    checkParamForProxies(e, 'document.write');\n  }\n  if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(e.call) === \"function write() { [native code] }\") {\n    checkParamForProxies(e, 'document.write');\n  }\n  if (e.call === eval) {\n    checkParamForProxies(e, 'eval', [0]);\n  }\n  if (e.call === setTimeout) {\n    checkParamForProxies(e, 'setTimeout', [0]);\n  }\n  if (e.call === setInterval) {\n    checkParamForProxies(e, 'setInterval', [0]);\n  }\n  if (e.callee === 'html') {\n    checkParamForProxies(e, 'jquery', [0]);\n  }\n  if (e.call === Element.prototype.insertAdjacentHTML) {\n    checkParamForProxies(e, 'insertAdjacentHTML', [1]);\n  }\n  if (e.callee === 'postMessage') {\n    if (e.arguments.length && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.arguments[0]) && (e.arguments[0].__get_identifier.startsWith('cookie') || e.arguments[0].__get_identifier.startsWith('storage'))) {\n      checkParamForProxies(e, 'postMessageLeak', [0], true);\n    } else {\n      checkParamForProxies(e, 'postMessageRelay', [0], true);\n    }\n  }\n  if (e.call === localStorage.setItem) {\n    if (e.arguments.length === 2 && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.arguments[0]) && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.arguments[1])) {\n      e.instance.ForceExecution.emitStorageAccess(e.arguments[0], e.arguments[1], e.hash)\n    }\n\n  }\n}\n\nfunction generateBinaryResult(left, right, op, type, forced_execution) {\n  let isLeftProxy = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(left);\n  let isRightProxy = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(right);\n  if (isLeftProxy || isRightProxy) {\n    let identifier;\n    let last_ops;\n    let l_value = left;\n    let r_value = right;\n    let res_value, side, isRealValue;\n    if (isLeftProxy && isRightProxy) {\n      identifier = l_value.__get_identifier;\n      isRealValue = l_value.__is_real_value;\n      last_ops = l_value.__get_ops;\n      res_value = _evaluationHelper_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].evalBinary(op, l_value.__get_real_obj, r_value.__get_real_obj);\n      r_value = extractConstraintFromProxy(r_value);\n      side = 'both';\n    } else if (isLeftProxy) {\n      identifier = l_value.__get_identifier;\n      last_ops = l_value.__get_ops;\n      isRealValue = l_value.__is_real_value;\n      l_value = l_value.__get_real_obj;\n      res_value = _evaluationHelper_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].evalBinary(op, l_value, r_value);\n      side = 'left';\n      if (last_ops.length < 2)\n        forced_execution.addTypeInfo(identifier, typeof r_value)\n    } else {\n      identifier = r_value.__get_identifier;\n      last_ops = r_value.__get_ops;\n      isRealValue = r_value.__is_real_value;\n      r_value = r_value.__get_real_obj;\n      res_value = _evaluationHelper_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].evalBinary(op, l_value, r_value);\n      if (last_ops.length < 2)\n        forced_execution.addTypeInfo(identifier, typeof l_value);\n      side = 'right';\n    }\n    let new_ops = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(last_ops);\n    new_ops.push({\n      \"type\": type,\n      \"op\": op,\n      \"val\": isLeftProxy ? r_value : l_value,\n      side: side\n    });\n    return Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(res_value, identifier, new_ops, isRealValue);\n\n  }\n}\n\nfunction negateConstraint(constraint) {\n  return {'type': 'Unary', 'op': '!', val: constraint};\n}\n\nfunction isNativeFunc(fun) {\n  return Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(fun).indexOf('native code') > -1;\n}\n\nfunction isDestructiveCall(e) {\n  if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(e.call) === \"function removeChild() { [native code] }\") {\n    return true\n  }\n  return false;\n}\n\nfunction instrumentStage(stage) {\n  let funlistener = stage.addListener(Iroh.FUNCTION);\n  funlistener.on('return', (e) => {\n    let saved_state = e.instance.ForceExecution.savedFunState;\n    if (e.instance.ForceExecution.pathConstraints.length > 0 && saved_state.length > 0) {\n      for (let constraint of e.instance.ForceExecution.pathConstraints) {\n        saved_state[saved_state.length - 1].push(constraint);\n      }\n    }\n  });\n\n  let listener = stage.addListener(Iroh.CALL);\n  listener.on(\"before\", (e) => {\n    checkForFlowToSink(e);\n    if (isDestructiveCall(e)) {\n      console.warn('replacing destructive call with no-op', e.call);\n      e.call = function () {\n      };\n      return;\n    }\n\n    console.warn('this is before call', e);\n    if (e.external) {\n      if (!isNativeFunc(e.call) && e.object === null) {\n        // If it is not a native function we can hook it on the fly\n        let hooked;\n        if (fun_mapping.has(Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(e.call))) {\n          hooked = fun_mapping.get(Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(e.call));\n        } else {\n          window.__reportExternalFun(Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(e.call), e.instance.ForceExecution.handler_id);\n          hooked = new Iroh.Stage('(' + Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(e.call) + ')');\n          instrumentStage(hooked);\n          fun_mapping.set(Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(e.call), hooked);\n        }\n        let __begin_tests = () => {\n          e.instance.ForceExecution.inTest = true;\n          e.instance.ForceExecution.constraintBuffer = [];\n\n        };\n        hooked.ForceExecution = e.instance.ForceExecution;\n        let deepClone = window.deepClone;\n        e.call = eval(hooked.script);\n\n        e.instance.ForceExecution.savedFunState.push(e.instance.ForceExecution.pathConstraints);\n        e.instance.ForceExecution.pathConstraints = [];\n\n      } else {\n        if (e.object && e.object === JSON && e.callee === 'parse') {\n          e.arguments = ['{}']\n        }\n        for (let i = 0; i < e.arguments.length; i++) {\n          let arg = e.arguments[i];\n          if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(arg)) {\n            e.arguments[i] = e.arguments[i].__get_real_obj\n          }\n        }\n      }\n    }\n  });\n\n  listener.on(\"after\", (e) => {\n    console.log('calling', e);\n    if (e.external) {\n      if (!isNativeFunc(e.call) && e.object === null) {\n        // this is the case when we hooked the function on the fly and need to restore this functions setting\n        e.instance.ForceExecution.pathConstraints = e.instance.ForceExecution.savedFunState.pop();\n      }\n    }\n    if (e.object !== null) {\n      if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.object)) {\n        // if we call a function on the object it needs to be a real thing thus we need to put this into the SMT solver\n        // otherwise we might not consider this object if it does not partake in a conditional but this call would throw an exception\n        e.instance.ForceExecution.emitConstraint(extractConstraintFromProxy(e.object));\n        let identifier = e.object.__get_identifier;\n        let last_ops = e.object.__get_ops;\n        let new_ops = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(last_ops);\n        let isRealValue = e.object.__is_real_value;\n\n        new_ops.push({\n          type: 'member_function',\n          function_name: e.callee,\n          args: Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deProxifyArguments\"])([].slice.call(e.real_arguments))\n        });\n        e.return = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(e.return, identifier, new_ops, isRealValue);\n      } else if (e.object.__proto__ === RegExp.prototype && e.call === /a/.test && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.real_arguments[0])) {\n        let p = e.real_arguments[0];\n        let identifier = p.__get_identifier;\n        let last_ops = p.__get_ops;\n        let new_ops = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(last_ops);\n        let isRealValue = p.__is_real_value;\n\n\n        let regex = e.object.toString();\n\n        new_ops.push({\n          type: 'member_function',\n          function_name: 'match',\n          args: [regex.slice(1).slice(0, regex.lastIndexOf('/') - 1)]\n        });\n        e.return = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(e.return, identifier, new_ops, isRealValue);\n      } else if (e.arguments.length) {\n        if (e.object === JSON && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.real_arguments[0])) {\n          // the case for e.g. JSON.parse\n          let p = e.real_arguments[0];\n          let identifier = p.__get_identifier;\n          let last_ops = p.__get_ops;\n          let new_ops = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(last_ops);\n          let isRealValue = p.__is_real_value;\n\n          new_ops.push({\n            type: 'external_function',\n            function_name: 'JSON.parse',\n            args: Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deProxifyArguments\"])([].slice.call(e.real_arguments))\n          });\n          e.return = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(e.return, identifier, new_ops, isRealValue);\n        } else if (e.object === localStorage && e.callee === 'getItem') {\n          if (shouldPrivacyThings) {\n            let ops = [];\n            let id;\n            if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.real_arguments[0])) {\n              ops.push({\n                type: 'member_function',\n                function_name: e.callee,\n                args: [extractConstraintFromProxy(e.real_arguments[0])]\n              });\n              id = '';\n            } else {\n              id = e.real_arguments[0]\n            }\n            e.return = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(id, 'storage', ops, true)\n          }\n        } else {\n          let hasProxyAsArgument = false;\n          let args = [];\n          for (let arg of e.real_arguments) {\n            if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(arg)) {\n              hasProxyAsArgument = true;\n              args.push(extractConstraintFromProxy(arg))\n            } else {\n              args.push(arg)\n            }\n          }\n          if (hasProxyAsArgument) {\n            e.return = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(e.object, e.object, [{\n              type: 'member_function',\n              function_name: e.callee,\n              args: args\n            }], true)\n          }\n        }\n      }\n    } else if (e.real_arguments.length === 1 && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.real_arguments[0]) && !e.name.startsWith(\"$$ANON\") && isNativeFunc(e.call)) {\n      let p = e.real_arguments[0];\n      let identifier = p.__get_identifier;\n      let last_ops = p.__get_ops;\n      let new_ops = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(last_ops);\n      let isRealValue = p.__is_real_value;\n\n      new_ops.push({\n        type: 'external_function',\n        function_name: e.name,\n        args: Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deProxifyArguments\"])([].slice.call(e.real_arguments))\n      });\n\n      e.return = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(e.return, identifier, new_ops, isRealValue)\n    }\n\n  });\n\n  let memberListener = stage.addListener(Iroh.MEMBER);\n  memberListener.on(\"fire\", (e) => {\n    console.log('Member', e);\n    if (e.object === document && e.property === 'cookie' && shouldPrivacyThings) {\n      e.object = {};\n      e.object[e.property] = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(document.cookie, 'cookie', [], true)\n    }\n    if (e.object === localStorage && typeof e.object[e.property] !== 'function' && shouldPrivacyThings) {\n      let ops = [];\n      let id;\n      if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.property)) {\n        ops.push({\n          type: 'member_function',\n          function_name: 'getItem',\n          args: [extractConstraintFromProxy(e.property)]\n        });\n        id = '';\n      } else {\n        id = e.property\n      }\n      e.object = {};\n\n      e.object[e.property] = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(id, 'storage', ops, true)\n    }\n    // takes care that environment does not produce errors when accessing further things on non-existing properties\n    // let accessed_prop = e.object[e.property];\n    //if (!isProxy(accessed_prop) && accessed_prop === undefined) {\n    //  e.object[e.property] = {};\n    //}\n  });\n\n  let assignListener = stage.addListener(Iroh.ASSIGN);\n  assignListener.on(\"fire\", (e) => {\n    console.log('Assign', e);\n    if ((e.property === 'innerHTML' || e.property === 'outerHTML') && e.value && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value)) {\n      e.instance.ForceExecution.emitSinkAccess(e.value, 'innerHTML', -1, e.hash);\n    }\n    if ((e.property === 'textContent' || e.property === 'innerText' || e.property === 'text') && e.object instanceof HTMLScriptElement && e.value && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value)) {\n      e.instance.ForceExecution.emitSinkAccess(e.value, 'scriptTextContent', -1, e.hash);\n    }\n    if (e.object === localStorage && e.property && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.property) && e.value && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value)) {\n      e.instance.ForceExecution.emitStorageAccess(e.property, e.value, e.hash);\n    }\n    if (e.object === document && e.property && e.property === 'cookie' && e.value && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value)) {\n      e.instance.ForceExecution.emitSinkAccess(e.value, 'cookie', -1, e.hash);\n    }\n  });\n\n  let IFListener = stage.addListener(Iroh.IF);\n  IFListener.on(\"test\", (e) => {\n    console.log(\"IFTEST\", e, e.value);\n    let constraint;\n    if (constraint === undefined && e.value !== undefined && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value)) {\n      constraint = extractConstraintFromProxy(e.value);\n    }\n    if (constraint && e.instance.ForceExecution.stale.has(e.hash)) {\n      constraint = negateConstraint(constraint);\n    }\n    if (constraint)\n      e.instance.ForceExecution.emitConstraint(constraint);\n\n    e.instance.ForceExecution.clearLogicalConstraintBuffer();\n\n    e.value = !e.instance.ForceExecution.stale.has(e.hash);\n    console.log(\"Forcing branch to\", e.value)\n  });\n  IFListener.on(\"enter\", (e) => {\n    console.log(\"IFENTER\", e, e.value);\n    // For nested ifs we need to save the \"old\" hash and retrieve it later on\n    // such that we can really pinpoint which if was potential the culprit of an error and thus label this as stale\n    e.instance.ForceExecution.BBHashMap.set(e.hash, e.instance.ForceExecution.curBBHash);\n    e.instance.ForceExecution.curBBHash = e.hash;\n  });\n\n  IFListener.on(\"leave\", (e) => {\n    console.log(\"IFLEAVE\", e, e.value);\n    //e.instance.ForceExecution.popConstraint();\n    e.instance.ForceExecution.curBBHash = e.instance.ForceExecution.BBHashMap.get(e.hash);\n\n    if (e.instance.ForceExecution.shouldLabelAsStale && !e.instance.ForceExecution.stale.has(e.hash)) {\n      e.instance.ForceExecution.shouldLabelAsStale = false;\n      e.instance.ForceExecution.stale.add(e.hash);\n    }\n    console.log(\"leave if\", e)\n  });\n\n  let ELSEListener = stage.addListener(Iroh.ELSE);\n  ELSEListener.on(\"enter\", (e) => {\n    console.log(\"enter else\");\n  });\n  ELSEListener.on(\"leave\", (e) => {\n    console.log(\"leave else\");\n\n  });\n  let SWITCHListener = stage.addListener(Iroh.SWITCH);\n\n  SWITCHListener.on(\"test\", (e) => {\n    console.log(\"SWICHTEST\", e);\n    e.instance.ForceExecution.switchValue = e.value;\n    e.value = e.instance.ForceExecution.randomValue;\n  });\n\n  let CASEListener = stage.addListener(Iroh.CASE);\n\n  CASEListener.on(\"test\", (e) => {\n    console.log(\"CASETEST\", e);\n    if (e.instance.ForceExecution.stale.has(e.hash)) {\n      e.value = 'nope';\n    } else {\n      if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.instance.ForceExecution.switchValue)) {\n        let constraint = extractConstraintFromProxy(e.instance.ForceExecution.switchValue);\n        constraint['ops'].push({\n          \"type\": \"Binary\",\n          \"op\": '==',\n          \"val\": e.value,\n          \"side\": 'right',\n        })\n        ;\n        e.instance.ForceExecution.emitConstraint(constraint);\n      }\n      e.value = e.instance.ForceExecution.randomValue;\n    }\n    console.log(\"Forcing branch to\", e.value)\n  });\n\n  CASEListener.on(\"enter\", (e) => {\n    console.log(\"enter case\", e);\n    e.instance.ForceExecution.BBHashMap.set(e.hash, e.instance.ForceExecution.curBBHash);\n    e.instance.ForceExecution.curBBHash = e.hash;\n\n  });\n  CASEListener.on(\"leave\", (e) => {\n    e.instance.ForceExecution.curBBHash = e.instance.ForceExecution.BBHashMap.get(e.hash);\n\n    if (e.instance.ForceExecution.shouldLabelAsStale && !e.instance.ForceExecution.stale.has(e.hash)) {\n      e.instance.ForceExecution.shouldLabelAsStale = false;\n      e.instance.ForceExecution.stale.add(e.hash);\n    }\n    console.log(\"leave case\");\n  });\n\n  let LogicalListener = stage.addListener(Iroh.LOGICAL);\n  LogicalListener.on(\"before_second\", (e) => {\n    console.warn('before second');\n    // First we capture the actual result which in the case of chained\n    if (e.left !== null && typeof e.left == \"object\" && e.left.__is_proxy !== undefined) {\n      // Lazy execution leads to a situation where always the left one is the finished one, the right one is yet to be evaluated\n      e.instance.ForceExecution.emitLogicalConstraint(e.left.__get_ops, e.op, e.left.__get_identifier);\n    }\n    // We need to capture all logical things until end of if test.\n    e.result = e.op !== '||';\n  });\n\n  LogicalListener.on(\"fire\", (e) => {\n    console.warn(\"Logical Comparator\", e);\n    let res = generateBinaryResult(e.real_left, e.real_right, e.op, 'Logical', e.instance.ForceExecution);\n    if (res !== undefined) {\n      e.result = res;\n    }\n  });\n\n  let BinaryListener = stage.addListener(Iroh.BINARY);\n  BinaryListener.on(\"fire\", (e) => {\n    console.warn(\"BINARY Comparator\", e);\n    let res = generateBinaryResult(e.left, e.right, e.op, 'Binary', e.instance.ForceExecution);\n    if (res !== undefined) {\n      e.result = res;\n    }\n  });\n\n  let UnaryListener = stage.addListener(Iroh.UNARY);\n  UnaryListener.on(\"fire\", (e) => {\n    console.warn(\"Unary Comparator\", e);\n    let isProxyValue = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value);\n\n    if (isProxyValue) {\n      let identifier = e.value.__get_identifier;\n      let last_ops = e.value.__get_ops;\n      let real_value = e.value.__get_real_obj;\n      let isRealValue = e.value.__is_real_value;\n\n      let res_value = _evaluationHelper_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].evalUnary(e.op, real_value);\n      let new_ops = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"deepClone\"])(last_ops);\n      new_ops.push({\"type\": \"Unary\", \"op\": e.op});\n      e.result = Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"makeProxy\"])(res_value, identifier, new_ops, isRealValue);\n    }\n  });\n\n  let LoopListener = stage.addListener(Iroh.LOOP);\n  LoopListener.on(\"test\", (e) => {\n    let constraint;\n    if (constraint === undefined && e.value !== undefined && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value)) {\n      constraint = extractConstraintFromProxy(e.value);\n    }\n    // only emit constraint if we loop, otherwise dont add any constraint\n    // this will we cleaned up once we leave the loop\n    if (constraint && !e.instance.ForceExecution.forcedLoop.has(e.hash)) {\n      e.instance.ForceExecution.emitConstraint(constraint);\n    }\n    if (Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.value)) {\n      e.value = !e.instance.ForceExecution.forcedLoop.has(e.hash);\n      e.instance.ForceExecution.forcedLoop.add(e.hash);\n      console.log(\"Forcing For Loop to\", e.value)\n    }\n  });\n\n  let TernaryListener = stage.addListener(Iroh.TERNARY);\n  TernaryListener.on(\"before\", (e) => {\n    console.log(\"Ternary before\", e);\n    let constraint;\n    if (e.test !== undefined && Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"isProxy\"])(e.test)) {\n      constraint = extractConstraintFromProxy(e.test);\n    }\n    if (constraint && e.instance.ForceExecution.stale.has(e.hash)) {\n      constraint = negateConstraint(constraint);\n    }\n    if (constraint)\n      e.instance.ForceExecution.emitConstraint(constraint);\n\n    e.test = !e.instance.ForceExecution.stale.has(e.hash);\n\n    if (e.instance.ForceExecution.shouldLabelAsStale && !e.instance.ForceExecution.stale.has(e.hash)) {\n      e.instance.ForceExecution.shouldLabelAsStale = false;\n      e.instance.ForceExecution.stale.add(e.hash);\n    }\n  });\n}\n\n\nasync function analyzeHandler(code, handler_id) {\n  // ANALYZE HELPER VARIABLES\n  let stage;\n  try {\n    stage = new Iroh.Stage(`(${Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(code)})(ev)`);\n  } catch (e) {\n    console.error('WTF', code.toString());\n    window.__report_failed_handler(handler_id, 'Iroh could not parse this one!', Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(code));\n    return\n  }\n  instrumentStage(stage);\n\n  let i = 0;\n  let stale;\n  console.log('start analysis');\n  let fr = new _ForcedRun_js__WEBPACK_IMPORTED_MODULE_0__[\"ForcedRun\"](stage, handler_id, code);\n  do {\n    if (i++ === 30) {\n      console.error(\"Emergency break\");\n      break;\n    }\n    stale = fr.run(stage.script);\n\n  } while (!stale);\n\n  let exploitos = [];\n  for (let arr of fr.retrieveReport().values()) {\n    for (let report of arr) {\n      if (report['target'] !== 'manual') {\n        let p = Object(_ExploitGenerator_js__WEBPACK_IMPORTED_MODULE_3__[\"generateExploitForReport\"])(report, handler_id);\n        exploitos.push(p);\n      } else {\n        delete report.ev;\n        window.__report_manual_exploit(report, handler_id);\n      }\n    }\n  }\n  console.log('Waiting for all exploits', exploitos.length);\n  exploitos = await Promise.all(exploitos);\n  let entries = [...exploitos];\n  entries = entries.filter(function (entry) {\n    return entry !== undefined && entry !== null\n  });\n  for (let entry of entries) {\n    let cands = entry['candidates'];\n    let ev;\n    for (let cand of cands) {\n      try {\n        console.log(cand)\n        ev = cand['message'];\n        await window.__clean_for_exploit();\n        console.log(\"Trying Exploit stuff\", code, 'with', ev, handler_id);\n        eval(`(${Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"getFunctionString\"])(code)})(ev)`);\n\n        await Object(_util_js__WEBPACK_IMPORTED_MODULE_2__[\"delay\"])(1000)\n      } catch (e) {\n        console.error('Error in executing with payload', e, ev)\n      }\n      // check for alterations in stores\n      if (entry['sink'] === 'storage') {\n        for (let key in JSON.parse(JSON.stringify(localStorage))) {\n          if (key === cand['exploitId']) {\n            __crawly__(key);\n          }\n        }\n      }\n      if (entry['sink'] === 'cookie') {\n        let cookies = parseCookies();\n        let cookie_keys = Object.keys(cookies);\n        for (let key of cookie_keys) {\n          if (key === cand['exploitId']) {\n            __crawly__(key);\n          }\n        }\n      }\n    }\n  }\n  // report found exploits back to the crawler to save to DB/display to the console\n  await window.__report_exploits(Array.from(entries), handler_id);\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9BbmFseXplci5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL1BNQW5hbHl6ZXIvLi9BbmFseXplci5qcz8zODhhIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgKEMpIDIwMjAgIE1hcml1cyBTdGVmZmVucywgQ0lTUEFcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuKi9cblxuaW1wb3J0IHtGb3JjZWRSdW59IGZyb20gXCIuL0ZvcmNlZFJ1bi5qc1wiO1xuaW1wb3J0IGV2SGVscGVyIGZyb20gXCIuL2V2YWx1YXRpb25IZWxwZXIuanNcIjtcbmltcG9ydCB7ZGVlcENsb25lLCBtYWtlUHJveHksIHJhbmRvbVN0cmluZywgZGVsYXksIGlzUHJveHksIGRlUHJveGlmeUFyZ3VtZW50c30gZnJvbSAnLi91dGlsLmpzJztcbmltcG9ydCB7Z2VuZXJhdGVFeHBsb2l0Rm9yUmVwb3J0fSBmcm9tICcuL0V4cGxvaXRHZW5lcmF0b3IuanMnO1xuaW1wb3J0IHtnZXRGdW5jdGlvblN0cmluZ30gZnJvbSBcIi4vdXRpbFwiO1xuXG4vLyBnbG9iYWwgbWFwcGluZyBmcm9tIGFscmVhZHkgaW5zdHJ1bWVudGVkIGZ1bmN0aW9ucyB0byB0aGVpciBpbnN0cnVtZW50ZWQgY291bnRlcnBhcnRzXG5sZXQgZnVuX21hcHBpbmcgPSBuZXcgTWFwKCk7XG4vLyBzZWxlY3RpdmVseSBlbmFibGUvZGlzYWJsZSBwcm94eWluZyBvZiBkb2N1bWVudC5jb29raWUgbG9jYWxTdG9yYWdlIHZhbHVlc1xubGV0IHNob3VsZFByaXZhY3lUaGluZ3MgPSBmYWxzZTtcblxuXG5mdW5jdGlvbiBjaGVja1BhcmFtRm9yUHJveGllcyhlLCBzaW5rSUQsIGluZGl6ZXMgPSB1bmRlZmluZWQsIG1hbnVhbCA9IGZhbHNlKSB7XG4gIGxldCBhcmdzID0gZS5hcmd1bWVudHM7XG4gIGlmIChpbmRpemVzID09PSB1bmRlZmluZWQpIHtcbiAgICBpbmRpemVzID0gYXJncy5rZXlzKCk7XG4gIH1cbiAgZm9yIChsZXQgaSBvZiBpbmRpemVzKSB7XG4gICAgaWYgKGFyZ3MubGVuZ3RoID4gaSkge1xuICAgICAgaWYgKGFyZ3NbaV0gJiYgaXNQcm94eShhcmdzW2ldKSkge1xuICAgICAgICBpZiAoIW1hbnVhbClcbiAgICAgICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmVtaXRTaW5rQWNjZXNzKGFyZ3NbaV0sIHNpbmtJRCwgaSwgZS5oYXNoKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uZW1pdFNpbmtBY2Nlc3MoYXJnc1tpXSwgc2lua0lELCBpLCBlLmhhc2gsICdtYW51YWwnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VDb29raWVzKCkge1xuICBsZXQgY19zdCA9IGRvY3VtZW50LmNvb2tpZTtcbiAgbGV0IHBhcnNlZCA9IHt9O1xuICBmb3IgKGxldCBzcGxpdHRlZCBvZiBjX3N0LnNwbGl0KCc7JykpIHtcbiAgICBpZiAoc3BsaXR0ZWQuaW5kZXhPZignPScpID09PSAtMSkge1xuICAgICAgY29udGludWVcbiAgICB9XG4gICAgbGV0IFtrZXksIHZhbF0gPSBzcGxpdHRlZC5zcGxpdCgnPScpO1xuICAgIHBhcnNlZFtrZXkudHJpbSgpXSA9IHZhbC50cmltKClcbiAgfVxuICByZXR1cm4gcGFyc2VkO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0Q29uc3RyYWludEZyb21Qcm94eShwKSB7XG4gIGxldCBjb25zdHJhaW50O1xuICBpZiAocC5fX2lzX3JlYWxfdmFsdWUpIHtcbiAgICBjb25zdHJhaW50ID0ge29wczogZGVlcENsb25lKHAuX19nZXRfb3BzKSwgdmFsdWU6IHAuX19nZXRfaWRlbnRpZmllciwgaXNSZWFsVmFsdWU6IHRydWUsIHZhbDogcC5fX2dldF9yZWFsX29ian07XG4gIH0gZWxzZSB7XG4gICAgY29uc3RyYWludCA9IHtvcHM6IGRlZXBDbG9uZShwLl9fZ2V0X29wcyksIGlkZW50aWZpZXI6IHAuX19nZXRfaWRlbnRpZmllcn07XG4gIH1cbiAgcmV0dXJuIGNvbnN0cmFpbnQ7XG59XG5cbmZ1bmN0aW9uIGNoZWNrRm9yRmxvd1RvU2luayhlKSB7XG4gIC8vIHJlZmVyZW5jZXMgdG8gb3RoZXIgd2luZG93cyBkbyBub3QgeWV0IHdvcmsuXG4gIGlmIChlLmNhbGwgPT09IGRvY3VtZW50LndyaXRlKSB7XG4gICAgY2hlY2tQYXJhbUZvclByb3hpZXMoZSwgJ2RvY3VtZW50LndyaXRlJyk7XG4gIH1cbiAgaWYgKGdldEZ1bmN0aW9uU3RyaW5nKGUuY2FsbCkgPT09IFwiZnVuY3Rpb24gd3JpdGUoKSB7IFtuYXRpdmUgY29kZV0gfVwiKSB7XG4gICAgY2hlY2tQYXJhbUZvclByb3hpZXMoZSwgJ2RvY3VtZW50LndyaXRlJyk7XG4gIH1cbiAgaWYgKGUuY2FsbCA9PT0gZXZhbCkge1xuICAgIGNoZWNrUGFyYW1Gb3JQcm94aWVzKGUsICdldmFsJywgWzBdKTtcbiAgfVxuICBpZiAoZS5jYWxsID09PSBzZXRUaW1lb3V0KSB7XG4gICAgY2hlY2tQYXJhbUZvclByb3hpZXMoZSwgJ3NldFRpbWVvdXQnLCBbMF0pO1xuICB9XG4gIGlmIChlLmNhbGwgPT09IHNldEludGVydmFsKSB7XG4gICAgY2hlY2tQYXJhbUZvclByb3hpZXMoZSwgJ3NldEludGVydmFsJywgWzBdKTtcbiAgfVxuICBpZiAoZS5jYWxsZWUgPT09ICdodG1sJykge1xuICAgIGNoZWNrUGFyYW1Gb3JQcm94aWVzKGUsICdqcXVlcnknLCBbMF0pO1xuICB9XG4gIGlmIChlLmNhbGwgPT09IEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFkamFjZW50SFRNTCkge1xuICAgIGNoZWNrUGFyYW1Gb3JQcm94aWVzKGUsICdpbnNlcnRBZGphY2VudEhUTUwnLCBbMV0pO1xuICB9XG4gIGlmIChlLmNhbGxlZSA9PT0gJ3Bvc3RNZXNzYWdlJykge1xuICAgIGlmIChlLmFyZ3VtZW50cy5sZW5ndGggJiYgaXNQcm94eShlLmFyZ3VtZW50c1swXSkgJiYgKGUuYXJndW1lbnRzWzBdLl9fZ2V0X2lkZW50aWZpZXIuc3RhcnRzV2l0aCgnY29va2llJykgfHwgZS5hcmd1bWVudHNbMF0uX19nZXRfaWRlbnRpZmllci5zdGFydHNXaXRoKCdzdG9yYWdlJykpKSB7XG4gICAgICBjaGVja1BhcmFtRm9yUHJveGllcyhlLCAncG9zdE1lc3NhZ2VMZWFrJywgWzBdLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hlY2tQYXJhbUZvclByb3hpZXMoZSwgJ3Bvc3RNZXNzYWdlUmVsYXknLCBbMF0sIHRydWUpO1xuICAgIH1cbiAgfVxuICBpZiAoZS5jYWxsID09PSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSkge1xuICAgIGlmIChlLmFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgaXNQcm94eShlLmFyZ3VtZW50c1swXSkgJiYgaXNQcm94eShlLmFyZ3VtZW50c1sxXSkpIHtcbiAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uZW1pdFN0b3JhZ2VBY2Nlc3MoZS5hcmd1bWVudHNbMF0sIGUuYXJndW1lbnRzWzFdLCBlLmhhc2gpXG4gICAgfVxuXG4gIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVCaW5hcnlSZXN1bHQobGVmdCwgcmlnaHQsIG9wLCB0eXBlLCBmb3JjZWRfZXhlY3V0aW9uKSB7XG4gIGxldCBpc0xlZnRQcm94eSA9IGlzUHJveHkobGVmdCk7XG4gIGxldCBpc1JpZ2h0UHJveHkgPSBpc1Byb3h5KHJpZ2h0KTtcbiAgaWYgKGlzTGVmdFByb3h5IHx8IGlzUmlnaHRQcm94eSkge1xuICAgIGxldCBpZGVudGlmaWVyO1xuICAgIGxldCBsYXN0X29wcztcbiAgICBsZXQgbF92YWx1ZSA9IGxlZnQ7XG4gICAgbGV0IHJfdmFsdWUgPSByaWdodDtcbiAgICBsZXQgcmVzX3ZhbHVlLCBzaWRlLCBpc1JlYWxWYWx1ZTtcbiAgICBpZiAoaXNMZWZ0UHJveHkgJiYgaXNSaWdodFByb3h5KSB7XG4gICAgICBpZGVudGlmaWVyID0gbF92YWx1ZS5fX2dldF9pZGVudGlmaWVyO1xuICAgICAgaXNSZWFsVmFsdWUgPSBsX3ZhbHVlLl9faXNfcmVhbF92YWx1ZTtcbiAgICAgIGxhc3Rfb3BzID0gbF92YWx1ZS5fX2dldF9vcHM7XG4gICAgICByZXNfdmFsdWUgPSBldkhlbHBlci5ldmFsQmluYXJ5KG9wLCBsX3ZhbHVlLl9fZ2V0X3JlYWxfb2JqLCByX3ZhbHVlLl9fZ2V0X3JlYWxfb2JqKTtcbiAgICAgIHJfdmFsdWUgPSBleHRyYWN0Q29uc3RyYWludEZyb21Qcm94eShyX3ZhbHVlKTtcbiAgICAgIHNpZGUgPSAnYm90aCc7XG4gICAgfSBlbHNlIGlmIChpc0xlZnRQcm94eSkge1xuICAgICAgaWRlbnRpZmllciA9IGxfdmFsdWUuX19nZXRfaWRlbnRpZmllcjtcbiAgICAgIGxhc3Rfb3BzID0gbF92YWx1ZS5fX2dldF9vcHM7XG4gICAgICBpc1JlYWxWYWx1ZSA9IGxfdmFsdWUuX19pc19yZWFsX3ZhbHVlO1xuICAgICAgbF92YWx1ZSA9IGxfdmFsdWUuX19nZXRfcmVhbF9vYmo7XG4gICAgICByZXNfdmFsdWUgPSBldkhlbHBlci5ldmFsQmluYXJ5KG9wLCBsX3ZhbHVlLCByX3ZhbHVlKTtcbiAgICAgIHNpZGUgPSAnbGVmdCc7XG4gICAgICBpZiAobGFzdF9vcHMubGVuZ3RoIDwgMilcbiAgICAgICAgZm9yY2VkX2V4ZWN1dGlvbi5hZGRUeXBlSW5mbyhpZGVudGlmaWVyLCB0eXBlb2Ygcl92YWx1ZSlcbiAgICB9IGVsc2Uge1xuICAgICAgaWRlbnRpZmllciA9IHJfdmFsdWUuX19nZXRfaWRlbnRpZmllcjtcbiAgICAgIGxhc3Rfb3BzID0gcl92YWx1ZS5fX2dldF9vcHM7XG4gICAgICBpc1JlYWxWYWx1ZSA9IHJfdmFsdWUuX19pc19yZWFsX3ZhbHVlO1xuICAgICAgcl92YWx1ZSA9IHJfdmFsdWUuX19nZXRfcmVhbF9vYmo7XG4gICAgICByZXNfdmFsdWUgPSBldkhlbHBlci5ldmFsQmluYXJ5KG9wLCBsX3ZhbHVlLCByX3ZhbHVlKTtcbiAgICAgIGlmIChsYXN0X29wcy5sZW5ndGggPCAyKVxuICAgICAgICBmb3JjZWRfZXhlY3V0aW9uLmFkZFR5cGVJbmZvKGlkZW50aWZpZXIsIHR5cGVvZiBsX3ZhbHVlKTtcbiAgICAgIHNpZGUgPSAncmlnaHQnO1xuICAgIH1cbiAgICBsZXQgbmV3X29wcyA9IGRlZXBDbG9uZShsYXN0X29wcyk7XG4gICAgbmV3X29wcy5wdXNoKHtcbiAgICAgIFwidHlwZVwiOiB0eXBlLFxuICAgICAgXCJvcFwiOiBvcCxcbiAgICAgIFwidmFsXCI6IGlzTGVmdFByb3h5ID8gcl92YWx1ZSA6IGxfdmFsdWUsXG4gICAgICBzaWRlOiBzaWRlXG4gICAgfSk7XG4gICAgcmV0dXJuIG1ha2VQcm94eShyZXNfdmFsdWUsIGlkZW50aWZpZXIsIG5ld19vcHMsIGlzUmVhbFZhbHVlKTtcblxuICB9XG59XG5cbmZ1bmN0aW9uIG5lZ2F0ZUNvbnN0cmFpbnQoY29uc3RyYWludCkge1xuICByZXR1cm4geyd0eXBlJzogJ1VuYXJ5JywgJ29wJzogJyEnLCB2YWw6IGNvbnN0cmFpbnR9O1xufVxuXG5mdW5jdGlvbiBpc05hdGl2ZUZ1bmMoZnVuKSB7XG4gIHJldHVybiBnZXRGdW5jdGlvblN0cmluZyhmdW4pLmluZGV4T2YoJ25hdGl2ZSBjb2RlJykgPiAtMTtcbn1cblxuZnVuY3Rpb24gaXNEZXN0cnVjdGl2ZUNhbGwoZSkge1xuICBpZiAoZ2V0RnVuY3Rpb25TdHJpbmcoZS5jYWxsKSA9PT0gXCJmdW5jdGlvbiByZW1vdmVDaGlsZCgpIHsgW25hdGl2ZSBjb2RlXSB9XCIpIHtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaW5zdHJ1bWVudFN0YWdlKHN0YWdlKSB7XG4gIGxldCBmdW5saXN0ZW5lciA9IHN0YWdlLmFkZExpc3RlbmVyKElyb2guRlVOQ1RJT04pO1xuICBmdW5saXN0ZW5lci5vbigncmV0dXJuJywgKGUpID0+IHtcbiAgICBsZXQgc2F2ZWRfc3RhdGUgPSBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnNhdmVkRnVuU3RhdGU7XG4gICAgaWYgKGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24ucGF0aENvbnN0cmFpbnRzLmxlbmd0aCA+IDAgJiYgc2F2ZWRfc3RhdGUubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChsZXQgY29uc3RyYWludCBvZiBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnBhdGhDb25zdHJhaW50cykge1xuICAgICAgICBzYXZlZF9zdGF0ZVtzYXZlZF9zdGF0ZS5sZW5ndGggLSAxXS5wdXNoKGNvbnN0cmFpbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgbGV0IGxpc3RlbmVyID0gc3RhZ2UuYWRkTGlzdGVuZXIoSXJvaC5DQUxMKTtcbiAgbGlzdGVuZXIub24oXCJiZWZvcmVcIiwgKGUpID0+IHtcbiAgICBjaGVja0ZvckZsb3dUb1NpbmsoZSk7XG4gICAgaWYgKGlzRGVzdHJ1Y3RpdmVDYWxsKGUpKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ3JlcGxhY2luZyBkZXN0cnVjdGl2ZSBjYWxsIHdpdGggbm8tb3AnLCBlLmNhbGwpO1xuICAgICAgZS5jYWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgfTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLndhcm4oJ3RoaXMgaXMgYmVmb3JlIGNhbGwnLCBlKTtcbiAgICBpZiAoZS5leHRlcm5hbCkge1xuICAgICAgaWYgKCFpc05hdGl2ZUZ1bmMoZS5jYWxsKSAmJiBlLm9iamVjdCA9PT0gbnVsbCkge1xuICAgICAgICAvLyBJZiBpdCBpcyBub3QgYSBuYXRpdmUgZnVuY3Rpb24gd2UgY2FuIGhvb2sgaXQgb24gdGhlIGZseVxuICAgICAgICBsZXQgaG9va2VkO1xuICAgICAgICBpZiAoZnVuX21hcHBpbmcuaGFzKGdldEZ1bmN0aW9uU3RyaW5nKGUuY2FsbCkpKSB7XG4gICAgICAgICAgaG9va2VkID0gZnVuX21hcHBpbmcuZ2V0KGdldEZ1bmN0aW9uU3RyaW5nKGUuY2FsbCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdpbmRvdy5fX3JlcG9ydEV4dGVybmFsRnVuKGdldEZ1bmN0aW9uU3RyaW5nKGUuY2FsbCksIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uaGFuZGxlcl9pZCk7XG4gICAgICAgICAgaG9va2VkID0gbmV3IElyb2guU3RhZ2UoJygnICsgZ2V0RnVuY3Rpb25TdHJpbmcoZS5jYWxsKSArICcpJyk7XG4gICAgICAgICAgaW5zdHJ1bWVudFN0YWdlKGhvb2tlZCk7XG4gICAgICAgICAgZnVuX21hcHBpbmcuc2V0KGdldEZ1bmN0aW9uU3RyaW5nKGUuY2FsbCksIGhvb2tlZCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IF9fYmVnaW5fdGVzdHMgPSAoKSA9PiB7XG4gICAgICAgICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5pblRlc3QgPSB0cnVlO1xuICAgICAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uY29uc3RyYWludEJ1ZmZlciA9IFtdO1xuXG4gICAgICAgIH07XG4gICAgICAgIGhvb2tlZC5Gb3JjZUV4ZWN1dGlvbiA9IGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb247XG4gICAgICAgIGxldCBkZWVwQ2xvbmUgPSB3aW5kb3cuZGVlcENsb25lO1xuICAgICAgICBlLmNhbGwgPSBldmFsKGhvb2tlZC5zY3JpcHQpO1xuXG4gICAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc2F2ZWRGdW5TdGF0ZS5wdXNoKGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24ucGF0aENvbnN0cmFpbnRzKTtcbiAgICAgICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5wYXRoQ29uc3RyYWludHMgPSBbXTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGUub2JqZWN0ICYmIGUub2JqZWN0ID09PSBKU09OICYmIGUuY2FsbGVlID09PSAncGFyc2UnKSB7XG4gICAgICAgICAgZS5hcmd1bWVudHMgPSBbJ3t9J11cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGUuYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgbGV0IGFyZyA9IGUuYXJndW1lbnRzW2ldO1xuICAgICAgICAgIGlmIChpc1Byb3h5KGFyZykpIHtcbiAgICAgICAgICAgIGUuYXJndW1lbnRzW2ldID0gZS5hcmd1bWVudHNbaV0uX19nZXRfcmVhbF9vYmpcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGxpc3RlbmVyLm9uKFwiYWZ0ZXJcIiwgKGUpID0+IHtcbiAgICBjb25zb2xlLmxvZygnY2FsbGluZycsIGUpO1xuICAgIGlmIChlLmV4dGVybmFsKSB7XG4gICAgICBpZiAoIWlzTmF0aXZlRnVuYyhlLmNhbGwpICYmIGUub2JqZWN0ID09PSBudWxsKSB7XG4gICAgICAgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlbiB3ZSBob29rZWQgdGhlIGZ1bmN0aW9uIG9uIHRoZSBmbHkgYW5kIG5lZWQgdG8gcmVzdG9yZSB0aGlzIGZ1bmN0aW9ucyBzZXR0aW5nXG4gICAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24ucGF0aENvbnN0cmFpbnRzID0gZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5zYXZlZEZ1blN0YXRlLnBvcCgpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZS5vYmplY3QgIT09IG51bGwpIHtcbiAgICAgIGlmIChpc1Byb3h5KGUub2JqZWN0KSkge1xuICAgICAgICAvLyBpZiB3ZSBjYWxsIGEgZnVuY3Rpb24gb24gdGhlIG9iamVjdCBpdCBuZWVkcyB0byBiZSBhIHJlYWwgdGhpbmcgdGh1cyB3ZSBuZWVkIHRvIHB1dCB0aGlzIGludG8gdGhlIFNNVCBzb2x2ZXJcbiAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIG1pZ2h0IG5vdCBjb25zaWRlciB0aGlzIG9iamVjdCBpZiBpdCBkb2VzIG5vdCBwYXJ0YWtlIGluIGEgY29uZGl0aW9uYWwgYnV0IHRoaXMgY2FsbCB3b3VsZCB0aHJvdyBhbiBleGNlcHRpb25cbiAgICAgICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5lbWl0Q29uc3RyYWludChleHRyYWN0Q29uc3RyYWludEZyb21Qcm94eShlLm9iamVjdCkpO1xuICAgICAgICBsZXQgaWRlbnRpZmllciA9IGUub2JqZWN0Ll9fZ2V0X2lkZW50aWZpZXI7XG4gICAgICAgIGxldCBsYXN0X29wcyA9IGUub2JqZWN0Ll9fZ2V0X29wcztcbiAgICAgICAgbGV0IG5ld19vcHMgPSBkZWVwQ2xvbmUobGFzdF9vcHMpO1xuICAgICAgICBsZXQgaXNSZWFsVmFsdWUgPSBlLm9iamVjdC5fX2lzX3JlYWxfdmFsdWU7XG5cbiAgICAgICAgbmV3X29wcy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAnbWVtYmVyX2Z1bmN0aW9uJyxcbiAgICAgICAgICBmdW5jdGlvbl9uYW1lOiBlLmNhbGxlZSxcbiAgICAgICAgICBhcmdzOiBkZVByb3hpZnlBcmd1bWVudHMoW10uc2xpY2UuY2FsbChlLnJlYWxfYXJndW1lbnRzKSlcbiAgICAgICAgfSk7XG4gICAgICAgIGUucmV0dXJuID0gbWFrZVByb3h5KGUucmV0dXJuLCBpZGVudGlmaWVyLCBuZXdfb3BzLCBpc1JlYWxWYWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKGUub2JqZWN0Ll9fcHJvdG9fXyA9PT0gUmVnRXhwLnByb3RvdHlwZSAmJiBlLmNhbGwgPT09IC9hLy50ZXN0ICYmIGlzUHJveHkoZS5yZWFsX2FyZ3VtZW50c1swXSkpIHtcbiAgICAgICAgbGV0IHAgPSBlLnJlYWxfYXJndW1lbnRzWzBdO1xuICAgICAgICBsZXQgaWRlbnRpZmllciA9IHAuX19nZXRfaWRlbnRpZmllcjtcbiAgICAgICAgbGV0IGxhc3Rfb3BzID0gcC5fX2dldF9vcHM7XG4gICAgICAgIGxldCBuZXdfb3BzID0gZGVlcENsb25lKGxhc3Rfb3BzKTtcbiAgICAgICAgbGV0IGlzUmVhbFZhbHVlID0gcC5fX2lzX3JlYWxfdmFsdWU7XG5cblxuICAgICAgICBsZXQgcmVnZXggPSBlLm9iamVjdC50b1N0cmluZygpO1xuXG4gICAgICAgIG5ld19vcHMucHVzaCh7XG4gICAgICAgICAgdHlwZTogJ21lbWJlcl9mdW5jdGlvbicsXG4gICAgICAgICAgZnVuY3Rpb25fbmFtZTogJ21hdGNoJyxcbiAgICAgICAgICBhcmdzOiBbcmVnZXguc2xpY2UoMSkuc2xpY2UoMCwgcmVnZXgubGFzdEluZGV4T2YoJy8nKSAtIDEpXVxuICAgICAgICB9KTtcbiAgICAgICAgZS5yZXR1cm4gPSBtYWtlUHJveHkoZS5yZXR1cm4sIGlkZW50aWZpZXIsIG5ld19vcHMsIGlzUmVhbFZhbHVlKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5hcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgIGlmIChlLm9iamVjdCA9PT0gSlNPTiAmJiBpc1Byb3h5KGUucmVhbF9hcmd1bWVudHNbMF0pKSB7XG4gICAgICAgICAgLy8gdGhlIGNhc2UgZm9yIGUuZy4gSlNPTi5wYXJzZVxuICAgICAgICAgIGxldCBwID0gZS5yZWFsX2FyZ3VtZW50c1swXTtcbiAgICAgICAgICBsZXQgaWRlbnRpZmllciA9IHAuX19nZXRfaWRlbnRpZmllcjtcbiAgICAgICAgICBsZXQgbGFzdF9vcHMgPSBwLl9fZ2V0X29wcztcbiAgICAgICAgICBsZXQgbmV3X29wcyA9IGRlZXBDbG9uZShsYXN0X29wcyk7XG4gICAgICAgICAgbGV0IGlzUmVhbFZhbHVlID0gcC5fX2lzX3JlYWxfdmFsdWU7XG5cbiAgICAgICAgICBuZXdfb3BzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogJ2V4dGVybmFsX2Z1bmN0aW9uJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uX25hbWU6ICdKU09OLnBhcnNlJyxcbiAgICAgICAgICAgIGFyZ3M6IGRlUHJveGlmeUFyZ3VtZW50cyhbXS5zbGljZS5jYWxsKGUucmVhbF9hcmd1bWVudHMpKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGUucmV0dXJuID0gbWFrZVByb3h5KGUucmV0dXJuLCBpZGVudGlmaWVyLCBuZXdfb3BzLCBpc1JlYWxWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZS5vYmplY3QgPT09IGxvY2FsU3RvcmFnZSAmJiBlLmNhbGxlZSA9PT0gJ2dldEl0ZW0nKSB7XG4gICAgICAgICAgaWYgKHNob3VsZFByaXZhY3lUaGluZ3MpIHtcbiAgICAgICAgICAgIGxldCBvcHMgPSBbXTtcbiAgICAgICAgICAgIGxldCBpZDtcbiAgICAgICAgICAgIGlmIChpc1Byb3h5KGUucmVhbF9hcmd1bWVudHNbMF0pKSB7XG4gICAgICAgICAgICAgIG9wcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnbWVtYmVyX2Z1bmN0aW9uJyxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbl9uYW1lOiBlLmNhbGxlZSxcbiAgICAgICAgICAgICAgICBhcmdzOiBbZXh0cmFjdENvbnN0cmFpbnRGcm9tUHJveHkoZS5yZWFsX2FyZ3VtZW50c1swXSldXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZCA9ICcnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWQgPSBlLnJlYWxfYXJndW1lbnRzWzBdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlLnJldHVybiA9IG1ha2VQcm94eShpZCwgJ3N0b3JhZ2UnLCBvcHMsIHRydWUpXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBoYXNQcm94eUFzQXJndW1lbnQgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgYXJncyA9IFtdO1xuICAgICAgICAgIGZvciAobGV0IGFyZyBvZiBlLnJlYWxfYXJndW1lbnRzKSB7XG4gICAgICAgICAgICBpZiAoaXNQcm94eShhcmcpKSB7XG4gICAgICAgICAgICAgIGhhc1Byb3h5QXNBcmd1bWVudCA9IHRydWU7XG4gICAgICAgICAgICAgIGFyZ3MucHVzaChleHRyYWN0Q29uc3RyYWludEZyb21Qcm94eShhcmcpKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYXJncy5wdXNoKGFyZylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGhhc1Byb3h5QXNBcmd1bWVudCkge1xuICAgICAgICAgICAgZS5yZXR1cm4gPSBtYWtlUHJveHkoZS5vYmplY3QsIGUub2JqZWN0LCBbe1xuICAgICAgICAgICAgICB0eXBlOiAnbWVtYmVyX2Z1bmN0aW9uJyxcbiAgICAgICAgICAgICAgZnVuY3Rpb25fbmFtZTogZS5jYWxsZWUsXG4gICAgICAgICAgICAgIGFyZ3M6IGFyZ3NcbiAgICAgICAgICAgIH1dLCB0cnVlKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZS5yZWFsX2FyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgaXNQcm94eShlLnJlYWxfYXJndW1lbnRzWzBdKSAmJiAhZS5uYW1lLnN0YXJ0c1dpdGgoXCIkJEFOT05cIikgJiYgaXNOYXRpdmVGdW5jKGUuY2FsbCkpIHtcbiAgICAgIGxldCBwID0gZS5yZWFsX2FyZ3VtZW50c1swXTtcbiAgICAgIGxldCBpZGVudGlmaWVyID0gcC5fX2dldF9pZGVudGlmaWVyO1xuICAgICAgbGV0IGxhc3Rfb3BzID0gcC5fX2dldF9vcHM7XG4gICAgICBsZXQgbmV3X29wcyA9IGRlZXBDbG9uZShsYXN0X29wcyk7XG4gICAgICBsZXQgaXNSZWFsVmFsdWUgPSBwLl9faXNfcmVhbF92YWx1ZTtcblxuICAgICAgbmV3X29wcy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2V4dGVybmFsX2Z1bmN0aW9uJyxcbiAgICAgICAgZnVuY3Rpb25fbmFtZTogZS5uYW1lLFxuICAgICAgICBhcmdzOiBkZVByb3hpZnlBcmd1bWVudHMoW10uc2xpY2UuY2FsbChlLnJlYWxfYXJndW1lbnRzKSlcbiAgICAgIH0pO1xuXG4gICAgICBlLnJldHVybiA9IG1ha2VQcm94eShlLnJldHVybiwgaWRlbnRpZmllciwgbmV3X29wcywgaXNSZWFsVmFsdWUpXG4gICAgfVxuXG4gIH0pO1xuXG4gIGxldCBtZW1iZXJMaXN0ZW5lciA9IHN0YWdlLmFkZExpc3RlbmVyKElyb2guTUVNQkVSKTtcbiAgbWVtYmVyTGlzdGVuZXIub24oXCJmaXJlXCIsIChlKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ01lbWJlcicsIGUpO1xuICAgIGlmIChlLm9iamVjdCA9PT0gZG9jdW1lbnQgJiYgZS5wcm9wZXJ0eSA9PT0gJ2Nvb2tpZScgJiYgc2hvdWxkUHJpdmFjeVRoaW5ncykge1xuICAgICAgZS5vYmplY3QgPSB7fTtcbiAgICAgIGUub2JqZWN0W2UucHJvcGVydHldID0gbWFrZVByb3h5KGRvY3VtZW50LmNvb2tpZSwgJ2Nvb2tpZScsIFtdLCB0cnVlKVxuICAgIH1cbiAgICBpZiAoZS5vYmplY3QgPT09IGxvY2FsU3RvcmFnZSAmJiB0eXBlb2YgZS5vYmplY3RbZS5wcm9wZXJ0eV0gIT09ICdmdW5jdGlvbicgJiYgc2hvdWxkUHJpdmFjeVRoaW5ncykge1xuICAgICAgbGV0IG9wcyA9IFtdO1xuICAgICAgbGV0IGlkO1xuICAgICAgaWYgKGlzUHJveHkoZS5wcm9wZXJ0eSkpIHtcbiAgICAgICAgb3BzLnB1c2goe1xuICAgICAgICAgIHR5cGU6ICdtZW1iZXJfZnVuY3Rpb24nLFxuICAgICAgICAgIGZ1bmN0aW9uX25hbWU6ICdnZXRJdGVtJyxcbiAgICAgICAgICBhcmdzOiBbZXh0cmFjdENvbnN0cmFpbnRGcm9tUHJveHkoZS5wcm9wZXJ0eSldXG4gICAgICAgIH0pO1xuICAgICAgICBpZCA9ICcnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWQgPSBlLnByb3BlcnR5XG4gICAgICB9XG4gICAgICBlLm9iamVjdCA9IHt9O1xuXG4gICAgICBlLm9iamVjdFtlLnByb3BlcnR5XSA9IG1ha2VQcm94eShpZCwgJ3N0b3JhZ2UnLCBvcHMsIHRydWUpXG4gICAgfVxuICAgIC8vIHRha2VzIGNhcmUgdGhhdCBlbnZpcm9ubWVudCBkb2VzIG5vdCBwcm9kdWNlIGVycm9ycyB3aGVuIGFjY2Vzc2luZyBmdXJ0aGVyIHRoaW5ncyBvbiBub24tZXhpc3RpbmcgcHJvcGVydGllc1xuICAgIC8vIGxldCBhY2Nlc3NlZF9wcm9wID0gZS5vYmplY3RbZS5wcm9wZXJ0eV07XG4gICAgLy9pZiAoIWlzUHJveHkoYWNjZXNzZWRfcHJvcCkgJiYgYWNjZXNzZWRfcHJvcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gIGUub2JqZWN0W2UucHJvcGVydHldID0ge307XG4gICAgLy99XG4gIH0pO1xuXG4gIGxldCBhc3NpZ25MaXN0ZW5lciA9IHN0YWdlLmFkZExpc3RlbmVyKElyb2guQVNTSUdOKTtcbiAgYXNzaWduTGlzdGVuZXIub24oXCJmaXJlXCIsIChlKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ0Fzc2lnbicsIGUpO1xuICAgIGlmICgoZS5wcm9wZXJ0eSA9PT0gJ2lubmVySFRNTCcgfHwgZS5wcm9wZXJ0eSA9PT0gJ291dGVySFRNTCcpICYmIGUudmFsdWUgJiYgaXNQcm94eShlLnZhbHVlKSkge1xuICAgICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5lbWl0U2lua0FjY2VzcyhlLnZhbHVlLCAnaW5uZXJIVE1MJywgLTEsIGUuaGFzaCk7XG4gICAgfVxuICAgIGlmICgoZS5wcm9wZXJ0eSA9PT0gJ3RleHRDb250ZW50JyB8fCBlLnByb3BlcnR5ID09PSAnaW5uZXJUZXh0JyB8fCBlLnByb3BlcnR5ID09PSAndGV4dCcpICYmIGUub2JqZWN0IGluc3RhbmNlb2YgSFRNTFNjcmlwdEVsZW1lbnQgJiYgZS52YWx1ZSAmJiBpc1Byb3h5KGUudmFsdWUpKSB7XG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmVtaXRTaW5rQWNjZXNzKGUudmFsdWUsICdzY3JpcHRUZXh0Q29udGVudCcsIC0xLCBlLmhhc2gpO1xuICAgIH1cbiAgICBpZiAoZS5vYmplY3QgPT09IGxvY2FsU3RvcmFnZSAmJiBlLnByb3BlcnR5ICYmIGlzUHJveHkoZS5wcm9wZXJ0eSkgJiYgZS52YWx1ZSAmJiBpc1Byb3h5KGUudmFsdWUpKSB7XG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmVtaXRTdG9yYWdlQWNjZXNzKGUucHJvcGVydHksIGUudmFsdWUsIGUuaGFzaCk7XG4gICAgfVxuICAgIGlmIChlLm9iamVjdCA9PT0gZG9jdW1lbnQgJiYgZS5wcm9wZXJ0eSAmJiBlLnByb3BlcnR5ID09PSAnY29va2llJyAmJiBlLnZhbHVlICYmIGlzUHJveHkoZS52YWx1ZSkpIHtcbiAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uZW1pdFNpbmtBY2Nlc3MoZS52YWx1ZSwgJ2Nvb2tpZScsIC0xLCBlLmhhc2gpO1xuICAgIH1cbiAgfSk7XG5cbiAgbGV0IElGTGlzdGVuZXIgPSBzdGFnZS5hZGRMaXN0ZW5lcihJcm9oLklGKTtcbiAgSUZMaXN0ZW5lci5vbihcInRlc3RcIiwgKGUpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIklGVEVTVFwiLCBlLCBlLnZhbHVlKTtcbiAgICBsZXQgY29uc3RyYWludDtcbiAgICBpZiAoY29uc3RyYWludCA9PT0gdW5kZWZpbmVkICYmIGUudmFsdWUgIT09IHVuZGVmaW5lZCAmJiBpc1Byb3h5KGUudmFsdWUpKSB7XG4gICAgICBjb25zdHJhaW50ID0gZXh0cmFjdENvbnN0cmFpbnRGcm9tUHJveHkoZS52YWx1ZSk7XG4gICAgfVxuICAgIGlmIChjb25zdHJhaW50ICYmIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc3RhbGUuaGFzKGUuaGFzaCkpIHtcbiAgICAgIGNvbnN0cmFpbnQgPSBuZWdhdGVDb25zdHJhaW50KGNvbnN0cmFpbnQpO1xuICAgIH1cbiAgICBpZiAoY29uc3RyYWludClcbiAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uZW1pdENvbnN0cmFpbnQoY29uc3RyYWludCk7XG5cbiAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmNsZWFyTG9naWNhbENvbnN0cmFpbnRCdWZmZXIoKTtcblxuICAgIGUudmFsdWUgPSAhZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5zdGFsZS5oYXMoZS5oYXNoKTtcbiAgICBjb25zb2xlLmxvZyhcIkZvcmNpbmcgYnJhbmNoIHRvXCIsIGUudmFsdWUpXG4gIH0pO1xuICBJRkxpc3RlbmVyLm9uKFwiZW50ZXJcIiwgKGUpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIklGRU5URVJcIiwgZSwgZS52YWx1ZSk7XG4gICAgLy8gRm9yIG5lc3RlZCBpZnMgd2UgbmVlZCB0byBzYXZlIHRoZSBcIm9sZFwiIGhhc2ggYW5kIHJldHJpZXZlIGl0IGxhdGVyIG9uXG4gICAgLy8gc3VjaCB0aGF0IHdlIGNhbiByZWFsbHkgcGlucG9pbnQgd2hpY2ggaWYgd2FzIHBvdGVudGlhbCB0aGUgY3VscHJpdCBvZiBhbiBlcnJvciBhbmQgdGh1cyBsYWJlbCB0aGlzIGFzIHN0YWxlXG4gICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5CQkhhc2hNYXAuc2V0KGUuaGFzaCwgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5jdXJCQkhhc2gpO1xuICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uY3VyQkJIYXNoID0gZS5oYXNoO1xuICB9KTtcblxuICBJRkxpc3RlbmVyLm9uKFwibGVhdmVcIiwgKGUpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIklGTEVBVkVcIiwgZSwgZS52YWx1ZSk7XG4gICAgLy9lLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnBvcENvbnN0cmFpbnQoKTtcbiAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmN1ckJCSGFzaCA9IGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uQkJIYXNoTWFwLmdldChlLmhhc2gpO1xuXG4gICAgaWYgKGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc2hvdWxkTGFiZWxBc1N0YWxlICYmICFlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnN0YWxlLmhhcyhlLmhhc2gpKSB7XG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnNob3VsZExhYmVsQXNTdGFsZSA9IGZhbHNlO1xuICAgICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5zdGFsZS5hZGQoZS5oYXNoKTtcbiAgICB9XG4gICAgY29uc29sZS5sb2coXCJsZWF2ZSBpZlwiLCBlKVxuICB9KTtcblxuICBsZXQgRUxTRUxpc3RlbmVyID0gc3RhZ2UuYWRkTGlzdGVuZXIoSXJvaC5FTFNFKTtcbiAgRUxTRUxpc3RlbmVyLm9uKFwiZW50ZXJcIiwgKGUpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcImVudGVyIGVsc2VcIik7XG4gIH0pO1xuICBFTFNFTGlzdGVuZXIub24oXCJsZWF2ZVwiLCAoZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwibGVhdmUgZWxzZVwiKTtcblxuICB9KTtcbiAgbGV0IFNXSVRDSExpc3RlbmVyID0gc3RhZ2UuYWRkTGlzdGVuZXIoSXJvaC5TV0lUQ0gpO1xuXG4gIFNXSVRDSExpc3RlbmVyLm9uKFwidGVzdFwiLCAoZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwiU1dJQ0hURVNUXCIsIGUpO1xuICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc3dpdGNoVmFsdWUgPSBlLnZhbHVlO1xuICAgIGUudmFsdWUgPSBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnJhbmRvbVZhbHVlO1xuICB9KTtcblxuICBsZXQgQ0FTRUxpc3RlbmVyID0gc3RhZ2UuYWRkTGlzdGVuZXIoSXJvaC5DQVNFKTtcblxuICBDQVNFTGlzdGVuZXIub24oXCJ0ZXN0XCIsIChlKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJDQVNFVEVTVFwiLCBlKTtcbiAgICBpZiAoZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5zdGFsZS5oYXMoZS5oYXNoKSkge1xuICAgICAgZS52YWx1ZSA9ICdub3BlJztcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGlzUHJveHkoZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5zd2l0Y2hWYWx1ZSkpIHtcbiAgICAgICAgbGV0IGNvbnN0cmFpbnQgPSBleHRyYWN0Q29uc3RyYWludEZyb21Qcm94eShlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnN3aXRjaFZhbHVlKTtcbiAgICAgICAgY29uc3RyYWludFsnb3BzJ10ucHVzaCh7XG4gICAgICAgICAgXCJ0eXBlXCI6IFwiQmluYXJ5XCIsXG4gICAgICAgICAgXCJvcFwiOiAnPT0nLFxuICAgICAgICAgIFwidmFsXCI6IGUudmFsdWUsXG4gICAgICAgICAgXCJzaWRlXCI6ICdyaWdodCcsXG4gICAgICAgIH0pXG4gICAgICAgIDtcbiAgICAgICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5lbWl0Q29uc3RyYWludChjb25zdHJhaW50KTtcbiAgICAgIH1cbiAgICAgIGUudmFsdWUgPSBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnJhbmRvbVZhbHVlO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIkZvcmNpbmcgYnJhbmNoIHRvXCIsIGUudmFsdWUpXG4gIH0pO1xuXG4gIENBU0VMaXN0ZW5lci5vbihcImVudGVyXCIsIChlKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJlbnRlciBjYXNlXCIsIGUpO1xuICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uQkJIYXNoTWFwLnNldChlLmhhc2gsIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uY3VyQkJIYXNoKTtcbiAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmN1ckJCSGFzaCA9IGUuaGFzaDtcblxuICB9KTtcbiAgQ0FTRUxpc3RlbmVyLm9uKFwibGVhdmVcIiwgKGUpID0+IHtcbiAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmN1ckJCSGFzaCA9IGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uQkJIYXNoTWFwLmdldChlLmhhc2gpO1xuXG4gICAgaWYgKGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc2hvdWxkTGFiZWxBc1N0YWxlICYmICFlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnN0YWxlLmhhcyhlLmhhc2gpKSB7XG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnNob3VsZExhYmVsQXNTdGFsZSA9IGZhbHNlO1xuICAgICAgZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5zdGFsZS5hZGQoZS5oYXNoKTtcbiAgICB9XG4gICAgY29uc29sZS5sb2coXCJsZWF2ZSBjYXNlXCIpO1xuICB9KTtcblxuICBsZXQgTG9naWNhbExpc3RlbmVyID0gc3RhZ2UuYWRkTGlzdGVuZXIoSXJvaC5MT0dJQ0FMKTtcbiAgTG9naWNhbExpc3RlbmVyLm9uKFwiYmVmb3JlX3NlY29uZFwiLCAoZSkgPT4ge1xuICAgIGNvbnNvbGUud2FybignYmVmb3JlIHNlY29uZCcpO1xuICAgIC8vIEZpcnN0IHdlIGNhcHR1cmUgdGhlIGFjdHVhbCByZXN1bHQgd2hpY2ggaW4gdGhlIGNhc2Ugb2YgY2hhaW5lZFxuICAgIGlmIChlLmxlZnQgIT09IG51bGwgJiYgdHlwZW9mIGUubGVmdCA9PSBcIm9iamVjdFwiICYmIGUubGVmdC5fX2lzX3Byb3h5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIExhenkgZXhlY3V0aW9uIGxlYWRzIHRvIGEgc2l0dWF0aW9uIHdoZXJlIGFsd2F5cyB0aGUgbGVmdCBvbmUgaXMgdGhlIGZpbmlzaGVkIG9uZSwgdGhlIHJpZ2h0IG9uZSBpcyB5ZXQgdG8gYmUgZXZhbHVhdGVkXG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmVtaXRMb2dpY2FsQ29uc3RyYWludChlLmxlZnQuX19nZXRfb3BzLCBlLm9wLCBlLmxlZnQuX19nZXRfaWRlbnRpZmllcik7XG4gICAgfVxuICAgIC8vIFdlIG5lZWQgdG8gY2FwdHVyZSBhbGwgbG9naWNhbCB0aGluZ3MgdW50aWwgZW5kIG9mIGlmIHRlc3QuXG4gICAgZS5yZXN1bHQgPSBlLm9wICE9PSAnfHwnO1xuICB9KTtcblxuICBMb2dpY2FsTGlzdGVuZXIub24oXCJmaXJlXCIsIChlKSA9PiB7XG4gICAgY29uc29sZS53YXJuKFwiTG9naWNhbCBDb21wYXJhdG9yXCIsIGUpO1xuICAgIGxldCByZXMgPSBnZW5lcmF0ZUJpbmFyeVJlc3VsdChlLnJlYWxfbGVmdCwgZS5yZWFsX3JpZ2h0LCBlLm9wLCAnTG9naWNhbCcsIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24pO1xuICAgIGlmIChyZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZS5yZXN1bHQgPSByZXM7XG4gICAgfVxuICB9KTtcblxuICBsZXQgQmluYXJ5TGlzdGVuZXIgPSBzdGFnZS5hZGRMaXN0ZW5lcihJcm9oLkJJTkFSWSk7XG4gIEJpbmFyeUxpc3RlbmVyLm9uKFwiZmlyZVwiLCAoZSkgPT4ge1xuICAgIGNvbnNvbGUud2FybihcIkJJTkFSWSBDb21wYXJhdG9yXCIsIGUpO1xuICAgIGxldCByZXMgPSBnZW5lcmF0ZUJpbmFyeVJlc3VsdChlLmxlZnQsIGUucmlnaHQsIGUub3AsICdCaW5hcnknLCBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uKTtcbiAgICBpZiAocmVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGUucmVzdWx0ID0gcmVzO1xuICAgIH1cbiAgfSk7XG5cbiAgbGV0IFVuYXJ5TGlzdGVuZXIgPSBzdGFnZS5hZGRMaXN0ZW5lcihJcm9oLlVOQVJZKTtcbiAgVW5hcnlMaXN0ZW5lci5vbihcImZpcmVcIiwgKGUpID0+IHtcbiAgICBjb25zb2xlLndhcm4oXCJVbmFyeSBDb21wYXJhdG9yXCIsIGUpO1xuICAgIGxldCBpc1Byb3h5VmFsdWUgPSBpc1Byb3h5KGUudmFsdWUpO1xuXG4gICAgaWYgKGlzUHJveHlWYWx1ZSkge1xuICAgICAgbGV0IGlkZW50aWZpZXIgPSBlLnZhbHVlLl9fZ2V0X2lkZW50aWZpZXI7XG4gICAgICBsZXQgbGFzdF9vcHMgPSBlLnZhbHVlLl9fZ2V0X29wcztcbiAgICAgIGxldCByZWFsX3ZhbHVlID0gZS52YWx1ZS5fX2dldF9yZWFsX29iajtcbiAgICAgIGxldCBpc1JlYWxWYWx1ZSA9IGUudmFsdWUuX19pc19yZWFsX3ZhbHVlO1xuXG4gICAgICBsZXQgcmVzX3ZhbHVlID0gZXZIZWxwZXIuZXZhbFVuYXJ5KGUub3AsIHJlYWxfdmFsdWUpO1xuICAgICAgbGV0IG5ld19vcHMgPSBkZWVwQ2xvbmUobGFzdF9vcHMpO1xuICAgICAgbmV3X29wcy5wdXNoKHtcInR5cGVcIjogXCJVbmFyeVwiLCBcIm9wXCI6IGUub3B9KTtcbiAgICAgIGUucmVzdWx0ID0gbWFrZVByb3h5KHJlc192YWx1ZSwgaWRlbnRpZmllciwgbmV3X29wcywgaXNSZWFsVmFsdWUpO1xuICAgIH1cbiAgfSk7XG5cbiAgbGV0IExvb3BMaXN0ZW5lciA9IHN0YWdlLmFkZExpc3RlbmVyKElyb2guTE9PUCk7XG4gIExvb3BMaXN0ZW5lci5vbihcInRlc3RcIiwgKGUpID0+IHtcbiAgICBsZXQgY29uc3RyYWludDtcbiAgICBpZiAoY29uc3RyYWludCA9PT0gdW5kZWZpbmVkICYmIGUudmFsdWUgIT09IHVuZGVmaW5lZCAmJiBpc1Byb3h5KGUudmFsdWUpKSB7XG4gICAgICBjb25zdHJhaW50ID0gZXh0cmFjdENvbnN0cmFpbnRGcm9tUHJveHkoZS52YWx1ZSk7XG4gICAgfVxuICAgIC8vIG9ubHkgZW1pdCBjb25zdHJhaW50IGlmIHdlIGxvb3AsIG90aGVyd2lzZSBkb250IGFkZCBhbnkgY29uc3RyYWludFxuICAgIC8vIHRoaXMgd2lsbCB3ZSBjbGVhbmVkIHVwIG9uY2Ugd2UgbGVhdmUgdGhlIGxvb3BcbiAgICBpZiAoY29uc3RyYWludCAmJiAhZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5mb3JjZWRMb29wLmhhcyhlLmhhc2gpKSB7XG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmVtaXRDb25zdHJhaW50KGNvbnN0cmFpbnQpO1xuICAgIH1cbiAgICBpZiAoaXNQcm94eShlLnZhbHVlKSkge1xuICAgICAgZS52YWx1ZSA9ICFlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmZvcmNlZExvb3AuaGFzKGUuaGFzaCk7XG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmZvcmNlZExvb3AuYWRkKGUuaGFzaCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkZvcmNpbmcgRm9yIExvb3AgdG9cIiwgZS52YWx1ZSlcbiAgICB9XG4gIH0pO1xuXG4gIGxldCBUZXJuYXJ5TGlzdGVuZXIgPSBzdGFnZS5hZGRMaXN0ZW5lcihJcm9oLlRFUk5BUlkpO1xuICBUZXJuYXJ5TGlzdGVuZXIub24oXCJiZWZvcmVcIiwgKGUpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIlRlcm5hcnkgYmVmb3JlXCIsIGUpO1xuICAgIGxldCBjb25zdHJhaW50O1xuICAgIGlmIChlLnRlc3QgIT09IHVuZGVmaW5lZCAmJiBpc1Byb3h5KGUudGVzdCkpIHtcbiAgICAgIGNvbnN0cmFpbnQgPSBleHRyYWN0Q29uc3RyYWludEZyb21Qcm94eShlLnRlc3QpO1xuICAgIH1cbiAgICBpZiAoY29uc3RyYWludCAmJiBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnN0YWxlLmhhcyhlLmhhc2gpKSB7XG4gICAgICBjb25zdHJhaW50ID0gbmVnYXRlQ29uc3RyYWludChjb25zdHJhaW50KTtcbiAgICB9XG4gICAgaWYgKGNvbnN0cmFpbnQpXG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLmVtaXRDb25zdHJhaW50KGNvbnN0cmFpbnQpO1xuXG4gICAgZS50ZXN0ID0gIWUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc3RhbGUuaGFzKGUuaGFzaCk7XG5cbiAgICBpZiAoZS5pbnN0YW5jZS5Gb3JjZUV4ZWN1dGlvbi5zaG91bGRMYWJlbEFzU3RhbGUgJiYgIWUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc3RhbGUuaGFzKGUuaGFzaCkpIHtcbiAgICAgIGUuaW5zdGFuY2UuRm9yY2VFeGVjdXRpb24uc2hvdWxkTGFiZWxBc1N0YWxlID0gZmFsc2U7XG4gICAgICBlLmluc3RhbmNlLkZvcmNlRXhlY3V0aW9uLnN0YWxlLmFkZChlLmhhc2gpO1xuICAgIH1cbiAgfSk7XG59XG5cblxuYXN5bmMgZnVuY3Rpb24gYW5hbHl6ZUhhbmRsZXIoY29kZSwgaGFuZGxlcl9pZCkge1xuICAvLyBBTkFMWVpFIEhFTFBFUiBWQVJJQUJMRVNcbiAgbGV0IHN0YWdlO1xuICB0cnkge1xuICAgIHN0YWdlID0gbmV3IElyb2guU3RhZ2UoYCgke2dldEZ1bmN0aW9uU3RyaW5nKGNvZGUpfSkoZXYpYCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKCdXVEYnLCBjb2RlLnRvU3RyaW5nKCkpO1xuICAgIHdpbmRvdy5fX3JlcG9ydF9mYWlsZWRfaGFuZGxlcihoYW5kbGVyX2lkLCAnSXJvaCBjb3VsZCBub3QgcGFyc2UgdGhpcyBvbmUhJywgZ2V0RnVuY3Rpb25TdHJpbmcoY29kZSkpO1xuICAgIHJldHVyblxuICB9XG4gIGluc3RydW1lbnRTdGFnZShzdGFnZSk7XG5cbiAgbGV0IGkgPSAwO1xuICBsZXQgc3RhbGU7XG4gIGNvbnNvbGUubG9nKCdzdGFydCBhbmFseXNpcycpO1xuICBsZXQgZnIgPSBuZXcgRm9yY2VkUnVuKHN0YWdlLCBoYW5kbGVyX2lkLCBjb2RlKTtcbiAgZG8ge1xuICAgIGlmIChpKysgPT09IDMwKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRW1lcmdlbmN5IGJyZWFrXCIpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHN0YWxlID0gZnIucnVuKHN0YWdlLnNjcmlwdCk7XG5cbiAgfSB3aGlsZSAoIXN0YWxlKTtcblxuICBsZXQgZXhwbG9pdG9zID0gW107XG4gIGZvciAobGV0IGFyciBvZiBmci5yZXRyaWV2ZVJlcG9ydCgpLnZhbHVlcygpKSB7XG4gICAgZm9yIChsZXQgcmVwb3J0IG9mIGFycikge1xuICAgICAgaWYgKHJlcG9ydFsndGFyZ2V0J10gIT09ICdtYW51YWwnKSB7XG4gICAgICAgIGxldCBwID0gZ2VuZXJhdGVFeHBsb2l0Rm9yUmVwb3J0KHJlcG9ydCwgaGFuZGxlcl9pZCk7XG4gICAgICAgIGV4cGxvaXRvcy5wdXNoKHApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVsZXRlIHJlcG9ydC5ldjtcbiAgICAgICAgd2luZG93Ll9fcmVwb3J0X21hbnVhbF9leHBsb2l0KHJlcG9ydCwgaGFuZGxlcl9pZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGNvbnNvbGUubG9nKCdXYWl0aW5nIGZvciBhbGwgZXhwbG9pdHMnLCBleHBsb2l0b3MubGVuZ3RoKTtcbiAgZXhwbG9pdG9zID0gYXdhaXQgUHJvbWlzZS5hbGwoZXhwbG9pdG9zKTtcbiAgbGV0IGVudHJpZXMgPSBbLi4uZXhwbG9pdG9zXTtcbiAgZW50cmllcyA9IGVudHJpZXMuZmlsdGVyKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgIHJldHVybiBlbnRyeSAhPT0gdW5kZWZpbmVkICYmIGVudHJ5ICE9PSBudWxsXG4gIH0pO1xuICBmb3IgKGxldCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgbGV0IGNhbmRzID0gZW50cnlbJ2NhbmRpZGF0ZXMnXTtcbiAgICBsZXQgZXY7XG4gICAgZm9yIChsZXQgY2FuZCBvZiBjYW5kcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coY2FuZClcbiAgICAgICAgZXYgPSBjYW5kWydtZXNzYWdlJ107XG4gICAgICAgIGF3YWl0IHdpbmRvdy5fX2NsZWFuX2Zvcl9leHBsb2l0KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVHJ5aW5nIEV4cGxvaXQgc3R1ZmZcIiwgY29kZSwgJ3dpdGgnLCBldiwgaGFuZGxlcl9pZCk7XG4gICAgICAgIGV2YWwoYCgke2dldEZ1bmN0aW9uU3RyaW5nKGNvZGUpfSkoZXYpYCk7XG5cbiAgICAgICAgYXdhaXQgZGVsYXkoMTAwMClcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZXhlY3V0aW5nIHdpdGggcGF5bG9hZCcsIGUsIGV2KVxuICAgICAgfVxuICAgICAgLy8gY2hlY2sgZm9yIGFsdGVyYXRpb25zIGluIHN0b3Jlc1xuICAgICAgaWYgKGVudHJ5WydzaW5rJ10gPT09ICdzdG9yYWdlJykge1xuICAgICAgICBmb3IgKGxldCBrZXkgaW4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShsb2NhbFN0b3JhZ2UpKSkge1xuICAgICAgICAgIGlmIChrZXkgPT09IGNhbmRbJ2V4cGxvaXRJZCddKSB7XG4gICAgICAgICAgICBfX2NyYXdseV9fKGtleSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZW50cnlbJ3NpbmsnXSA9PT0gJ2Nvb2tpZScpIHtcbiAgICAgICAgbGV0IGNvb2tpZXMgPSBwYXJzZUNvb2tpZXMoKTtcbiAgICAgICAgbGV0IGNvb2tpZV9rZXlzID0gT2JqZWN0LmtleXMoY29va2llcyk7XG4gICAgICAgIGZvciAobGV0IGtleSBvZiBjb29raWVfa2V5cykge1xuICAgICAgICAgIGlmIChrZXkgPT09IGNhbmRbJ2V4cGxvaXRJZCddKSB7XG4gICAgICAgICAgICBfX2NyYXdseV9fKGtleSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIHJlcG9ydCBmb3VuZCBleHBsb2l0cyBiYWNrIHRvIHRoZSBjcmF3bGVyIHRvIHNhdmUgdG8gREIvZGlzcGxheSB0byB0aGUgY29uc29sZVxuICBhd2FpdCB3aW5kb3cuX19yZXBvcnRfZXhwbG9pdHMoQXJyYXkuZnJvbShlbnRyaWVzKSwgaGFuZGxlcl9pZCk7XG59XG5cbmV4cG9ydCB7YW5hbHl6ZUhhbmRsZXIsIGlzTmF0aXZlRnVuY30iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./Analyzer.js\n");

/***/ }),

/***/ "./ExploitGenerator.js":
/*!*****************************!*\
  !*** ./ExploitGenerator.js ***!
  \*****************************/
/*! exports provided: generateExploitForReport */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"generateExploitForReport\", function() { return generateExploitForReport; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./util.js\");\n/*\nCopyright (C) 2020  Marius Steffens, CISPA\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n\n\nconst SINK_MAPPING = {\n  'eval': 'JS',\n  'document.write': 'HTML',\n  'document.writeln': 'HTML',\n  'innerHTML': 'HTML',\n  'jquery': 'HTML',\n  'scriptTextContent': 'JS',\n  'insertAdjacentHTML': 'HTML',\n  'postMessage': 'PM',\n  'storage': 'storage',\n  'cookie': 'cookie',\n\n};\n\nfunction addPropToObj(obj, acc) {\n  if (typeof obj[acc] === 'object') {\n    // all good we have nothig to worry bout and can just add another one if necessary\n  } else {\n    // well we have constraint solved that parts of the thing needs to be that specific string\n    // substitute the string to a random key and hope for the best\n    let cur_value = obj[acc];\n    obj[acc] = {};\n    obj[acc]['__hope_for_the_best'] = cur_value;\n  }\n}\n\nfunction getJSExploits(sinkObject) {\n  let left, right;\n  let nonce_1 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_2 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_3 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_4 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_5 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_6 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_7 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_8 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let nonce_9 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n\n\n  let exploits = new Map();\n  let startswith_exploit_1 = {\n    \"type\": \"member_function\",\n    \"function_name\": \"startsWith\",\n    \"args\": [\n      '__crawly__(\"' + nonce_1 + '\")/*'\n    ]\n  };\n  let endswith_exploit_1 = {\n    \"type\": \"member_function\",\n    \"function_name\": \"endsWith\",\n    \"args\": [\n      ' */'\n    ]\n  };\n  left = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  right = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  left.ops.push(startswith_exploit_1);\n  right.ops.push(endswith_exploit_1);\n\n  let exp_1 = {type: 'Logical', op: '&&', l_val: left, r_val: right};\n  exploits.set(nonce_1, exp_1);\n\n  let startswith_exploit_2 = {\n    \"type\": \"member_function\",\n    \"function_name\": \"startsWith\",\n    \"args\": [\n      '(__crawly__(\"' + nonce_2 + '\")/*'\n    ]\n  };\n  let endswith_exploit_2 = {\n    \"type\": \"member_function\",\n    \"function_name\": \"endsWith\",\n    \"args\": [\n      ' */)'\n    ]\n  };\n\n  left = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  right = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  left.ops.push(startswith_exploit_2);\n  right.ops.push(endswith_exploit_2);\n\n  let exp_2 = {type: 'Logical', op: '&&', l_val: left, r_val: right};\n  exploits.set(nonce_2, exp_2);\n\n  let endswith_exploit_3 = {\n    \"type\": \"member_function\",\n    \"function_name\": \"endsWith\",\n    \"args\": [\n      ' */__crawly__(\"' + nonce_3 + '\")'\n    ]\n  };\n  let startswith_exploit_3 = {\n    \"type\": \"member_function\",\n    \"function_name\": \"startsWith\",\n    \"args\": [\n      '/*'\n    ]\n  };\n\n  left = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  right = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  left.ops.push(startswith_exploit_3);\n  right.ops.push(endswith_exploit_3);\n\n  let exp_3 = {type: 'Logical', op: '&&', l_val: left, r_val: right};\n  exploits.set(nonce_3, exp_3);\n\n  let kameeleon = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  kameeleon.ops.push({\n    type: \"Binary\",\n    op: '===',\n    side: 'left',\n    val: 'Kameleoon=1,__crawly__(\"' + nonce_4 + '\")'\n  });\n\n  exploits.set(nonce_4, kameeleon);\n\n  let startsWithFixObject = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  startsWithFixObject.ops.push({\n    type: \"member_function\",\n    function_name: \"endsWith\",\n    args: ['.toString(),__crawly__(\"' + nonce_5 + '\")']\n  });\n\n  exploits.set(nonce_5, startsWithFixObject);\n\n  let startsWithAssignement = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  startsWithAssignement.ops.push({\n    type: \"member_function\",\n    function_name: \"endsWith\",\n    args: ['1;__crawly__(\"' + nonce_6 + '\");']\n  });\n\n  exploits.set(nonce_6, startsWithAssignement);\n\n  let startsWithAssignementWithoutEqual = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  startsWithAssignementWithoutEqual.ops.push({\n    type: \"member_function\",\n    function_name: \"endsWith\",\n    args: ['=1;__crawly__(\"' + nonce_7 + '\");']\n  });\n\n  exploits.set(nonce_7, startsWithAssignementWithoutEqual);\n\n\n  let endsWithanything = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  endsWithanything.ops.push({\n    type: \"member_function\",\n    function_name: \"startsWith\",\n    args: ['__crawly__(\"' + nonce_8 + '\");//']\n  });\n\n  exploits.set(nonce_8, endsWithanything);\n\n  let wrapped_function = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  wrapped_function.ops.push({\n    \"type\": \"member_function\",\n    \"function_name\": \"startsWith\",\n    \"args\": [\n      '(function(){__crawly__(\"' + nonce_9 + '\")})();//'\n    ]\n  });\n  exploits.set(nonce_9, wrapped_function);\n\n  return exploits;\n\n}\n\nfunction getStorageExploits(key_obj, val_obj) {\n  let exploits = new Map();\n  let nonce_1 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n\n  let key_const = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(key_obj);\n  let val_const = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(val_obj);\n\n  key_const.ops.push({\n    \"type\": \"Binary\",\n    \"op\": '===',\n    \"side\": \"left\",\n    \"val\": nonce_1\n  });\n\n  val_const.ops.push({\n    \"type\": \"Binary\",\n    \"op\": '===',\n    \"side\": \"left\",\n    \"val\": nonce_1\n  });\n\n  exploits.set(nonce_1, {\n    \"type\": \"Logical\",\n    \"op\": '&&',\n    \"l_val\": key_const,\n    \"r_val\": val_const\n  });\n\n  return exploits\n}\n\nfunction getHTMLExploits(sinkObject) {\n  let exploits = new Map();\n\n  let nonce_1 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let exp1 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject)\n  let img_payload = '<img src=\"foo\" onerror=\"__crawly__(`__report_id`)\" onload=\"__crawly__(`__report_id`)\"><textarea>';\n  exp1.ops.push({\n    \"type\": \"member_function\",\n    \"function_name\": \"indexOf\",\n    \"args\": [img_payload.replace(/__report_id/g, nonce_1)],\n  });\n  exp1.ops.push({type: 'Binary', op: '>', side: 'left', val: 0})\n  exploits.set(nonce_1, exp1)\n  let nonce_3 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let exp3 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  let polyglot = \"`'\\\">--!></stYle/</titLe/</teXtarEa/</scRipt/><img/src=foo oNloAd=__crawly__(`__report_id`)//>\\x3e\\n\";\n  exp3.ops.push({\n    \"type\": \"member_function\",\n    \"function_name\": \"indexOf\",\n    \"args\": [polyglot.replace(/__report_id/g, nonce_3)],\n  });\n  exp3.ops.push({type: 'Binary', op: '>', side: 'left', val: 0});\n  exploits.set(nonce_3, exp3);\n\n\n  return exploits\n\n}\n\nfunction getOriginConstraints() {\n  return {\n    type: 'Logical', op: '||', l_val: {\n      \"ops\": [\n        {\n          \"type\": \"ops_on_parent_element\",\n          \"old_identifier\": \"event\",\n          \"old_ops\": []\n        },\n        {\n          \"type\": \"member_function\",\n          \"function_name\": \"substring\",\n          \"args\": [\n            0, 7\n          ]\n        },\n        {\n          \"type\": 'Binary',\n          \"side\": \"left\",\n          \"val\": \"http://\",\n          \"op\": '==='\n        }\n      ],\n      \"identifier\": \"event.origin\"\n    }, r_val: {\n      \"ops\": [\n        {\n          \"type\": \"ops_on_parent_element\",\n          \"old_identifier\": \"event\",\n          \"old_ops\": []\n        },\n        {\n          \"type\": \"member_function\",\n          \"function_name\": \"substring\",\n          \"args\": [\n            0, 8\n          ]\n        },\n        {\n          \"type\": 'Binary',\n          \"side\": \"left\",\n          \"val\": \"https://\",\n          \"op\": '==='\n        }\n      ],\n      \"identifier\": \"event.origin\"\n    }\n  }\n}\n\nfunction getCookieExploits(sinkObject) {\n  let nonce1 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n  let exploits = new Map();\n\n\n  let constraints = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(sinkObject);\n  constraints.ops.push({\n    \"type\": \"member_function\",\n    \"function_name\": \"startsWith\",\n    \"args\": [nonce1 + '=' + nonce1 + ';']\n  });\n  exploits.set(nonce1, constraints);\n\n  return exploits\n}\n\nasync function generateExploitForReport(report, handler_id) {\n  console.log('=============');\n  console.log('Starting exploit generation for ', report);\n  let inferred_types = {};\n  try {\n    //inferred_types = inferTypes(report.ev)\n    inferred_types = report.typeInfo;\n  } catch (e) {\n    console.error('Error when infering types', e)\n  }\n  let sink_obj_constraints;\n  switch (SINK_MAPPING[report.sink]) {\n    case 'JS':\n      sink_obj_constraints = getJSExploits(report.sinkObject);\n      break;\n    case 'HTML':\n      sink_obj_constraints = getHTMLExploits(report.sinkObject);\n      break;\n    case 'storage':\n      sink_obj_constraints = getStorageExploits(report.key_obj, report.val_obj);\n      break;\n    case 'cookie':\n      sink_obj_constraints = getCookieExploits(report.sinkObject);\n      break;\n\n    default:\n      throw Error('Sink not yet supported ' + report.sink)\n  }\n\n  let cs = report['constraints'];\n  let constraintId = await window.__reportBaseConstraint(cs, handler_id);\n\n  let origin_constraint = getOriginConstraints();\n  let exploit_candidates = [];\n  for (let exploitId of sink_obj_constraints.keys()) {\n    let candidate = sink_obj_constraints.get(exploitId);\n    let cs_cloned = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(cs);\n    // append exploit constraints\n    cs_cloned.push(candidate);\n    // append constraints for origin, e.g. starts with http etc\n    cs_cloned.push(origin_constraint);\n    // solve\n    let res = await window.__trySolveForSat(cs_cloned, inferred_types, constraintId, [candidate, origin_constraint], report['sink']);\n    if (res !== undefined) {\n      exploit_candidates.push({exploitCandidateId: res[1], exploitId: exploitId, payload_sat: res[0]});\n    }\n  }\n  if (exploit_candidates.length === 0) {\n    return undefined\n  }\n  let messages = [];\n  for (let entry of exploit_candidates) {\n    let mess1 = generateObjectFromAssignements(entry['payload_sat']['assignements'])['event'];\n    let mess2 = generateObjectFromAssignements(entry['payload_sat']['assignements'], undefined, false)['event'];\n    messages.push({\n      exploitId: entry['exploitId'],\n      exploitCandidateId: entry['exploitCandidateId'],\n      message: adjustForTypes(mess1, entry['payload_sat']['types'])\n    });\n    messages.push({\n      exploitId: entry['exploitId'],\n      exploitCandidateId: entry['exploitCandidateId'],\n      message: adjustForTypes(mess2, entry['payload_sat']['types'])\n    });\n\n  }\n  return {\n    candidates: messages,\n    sink: report.sink\n  };\n}\n\nfunction adjustForTypes(obj, types) {\n  for (let key of Object.keys(types)) {\n    if (types[key] !== 'JSON') {\n      continue;\n    }\n    let splitted = key.split('.');\n    let last = splitted.slice(-1);\n    let accessors = splitted.slice(0, splitted.length - 1);\n    let cur_obj = obj;\n    for (let accessor of accessors) {\n      if (accessor.startsWith('__elem__')) {\n        let num = parseInt(accessor.slice(8));\n        if (!Array.isArray(cur_obj)) {\n        }\n        accessor = num;\n      }\n      if (cur_obj[accessor] === undefined) {\n        break;\n      }\n      cur_obj = cur_obj[accessor];\n    }\n    cur_obj[last] = JSON.stringify(cur_obj[last])\n  }\n  return obj\n}\n\nfunction generateObjectFromAssignements(assignement, obj = undefined, dont_use_empty = true) {\n  if (obj === undefined) {\n    obj = {};\n  }\n  for (let key of Object.keys(assignement)) {\n    if (dont_use_empty && assignement[key] === '') {\n      continue\n    }\n    if (typeof assignement[key] === 'string') {\n      assignement[key] = assignement[key].replace(/\\\\x([0-9A-F]{2})/ig, function () {\n        return String.fromCharCode(parseInt(arguments[1], 16));\n      });\n    }\n    let splitted = key.split('.');\n    let last = splitted.slice(-1);\n    let accessors = splitted.slice(0, splitted.length - 1);\n    let cur_obj = obj;\n    for (let accessor of accessors) {\n      if (accessor.startsWith('__elem__')) {\n        let num = parseInt(accessor.slice(8));\n        if (!Array.isArray(cur_obj)) {\n        }\n        accessor = num;\n      }\n      if (cur_obj[accessor] === undefined) {\n        cur_obj[accessor] = {};\n      } else {\n        addPropToObj(cur_obj, accessor);\n      }\n      cur_obj = cur_obj[accessor];\n    }\n    if (cur_obj[last[0]] === undefined)\n      cur_obj[last[0]] = assignement[key];\n    else {\n      // this case only happens when we have an assignement for a parent object which is however already an object thus we cannot do it\n      cur_obj[last[0]]['__hope_for_the_best'] = assignement[key]\n    }\n  }\n  resolveSubstituteVals(obj, obj);\n  return obj;\n}\n\nfunction resolveSubstituteVals(obj, g) {\n  if (Array.isArray(obj)) {\n    for (let i = 0; i < obj.length; i++) {\n      let elem = resolveSubstituteVals(obj[i], g);\n      if (elem) {\n        obj[i] = elem;\n      }\n    }\n  } else if (typeof obj === 'object') {\n    for (let key of Object.keys(obj)) {\n      let elem = resolveSubstituteVals(obj[key], g);\n      if (elem) {\n        obj[key] = elem\n      }\n    }\n  } else if (typeof obj === 'string' && obj.startsWith('__substitute_values_')) {\n    return g[obj];\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9FeHBsb2l0R2VuZXJhdG9yLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUE1BbmFseXplci8uL0V4cGxvaXRHZW5lcmF0b3IuanM/MzhmNiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IChDKSAyMDIwICBNYXJpdXMgU3RlZmZlbnMsIENJU1BBXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiovXG5cbmltcG9ydCB7ZGVlcENsb25lLCByYW5kb21TdHJpbmd9IGZyb20gXCIuL3V0aWxcIjtcblxuY29uc3QgU0lOS19NQVBQSU5HID0ge1xuICAnZXZhbCc6ICdKUycsXG4gICdkb2N1bWVudC53cml0ZSc6ICdIVE1MJyxcbiAgJ2RvY3VtZW50LndyaXRlbG4nOiAnSFRNTCcsXG4gICdpbm5lckhUTUwnOiAnSFRNTCcsXG4gICdqcXVlcnknOiAnSFRNTCcsXG4gICdzY3JpcHRUZXh0Q29udGVudCc6ICdKUycsXG4gICdpbnNlcnRBZGphY2VudEhUTUwnOiAnSFRNTCcsXG4gICdwb3N0TWVzc2FnZSc6ICdQTScsXG4gICdzdG9yYWdlJzogJ3N0b3JhZ2UnLFxuICAnY29va2llJzogJ2Nvb2tpZScsXG5cbn07XG5cbmZ1bmN0aW9uIGFkZFByb3BUb09iaihvYmosIGFjYykge1xuICBpZiAodHlwZW9mIG9ialthY2NdID09PSAnb2JqZWN0Jykge1xuICAgIC8vIGFsbCBnb29kIHdlIGhhdmUgbm90aGlnIHRvIHdvcnJ5IGJvdXQgYW5kIGNhbiBqdXN0IGFkZCBhbm90aGVyIG9uZSBpZiBuZWNlc3NhcnlcbiAgfSBlbHNlIHtcbiAgICAvLyB3ZWxsIHdlIGhhdmUgY29uc3RyYWludCBzb2x2ZWQgdGhhdCBwYXJ0cyBvZiB0aGUgdGhpbmcgbmVlZHMgdG8gYmUgdGhhdCBzcGVjaWZpYyBzdHJpbmdcbiAgICAvLyBzdWJzdGl0dXRlIHRoZSBzdHJpbmcgdG8gYSByYW5kb20ga2V5IGFuZCBob3BlIGZvciB0aGUgYmVzdFxuICAgIGxldCBjdXJfdmFsdWUgPSBvYmpbYWNjXTtcbiAgICBvYmpbYWNjXSA9IHt9O1xuICAgIG9ialthY2NdWydfX2hvcGVfZm9yX3RoZV9iZXN0J10gPSBjdXJfdmFsdWU7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0SlNFeHBsb2l0cyhzaW5rT2JqZWN0KSB7XG4gIGxldCBsZWZ0LCByaWdodDtcbiAgbGV0IG5vbmNlXzEgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzIgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzMgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzQgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzUgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzYgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzcgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzggPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IG5vbmNlXzkgPSByYW5kb21TdHJpbmcoKTtcblxuXG4gIGxldCBleHBsb2l0cyA9IG5ldyBNYXAoKTtcbiAgbGV0IHN0YXJ0c3dpdGhfZXhwbG9pdF8xID0ge1xuICAgIFwidHlwZVwiOiBcIm1lbWJlcl9mdW5jdGlvblwiLFxuICAgIFwiZnVuY3Rpb25fbmFtZVwiOiBcInN0YXJ0c1dpdGhcIixcbiAgICBcImFyZ3NcIjogW1xuICAgICAgJ19fY3Jhd2x5X18oXCInICsgbm9uY2VfMSArICdcIikvKidcbiAgICBdXG4gIH07XG4gIGxldCBlbmRzd2l0aF9leHBsb2l0XzEgPSB7XG4gICAgXCJ0eXBlXCI6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgXCJmdW5jdGlvbl9uYW1lXCI6IFwiZW5kc1dpdGhcIixcbiAgICBcImFyZ3NcIjogW1xuICAgICAgJyAqLydcbiAgICBdXG4gIH07XG4gIGxlZnQgPSBkZWVwQ2xvbmUoc2lua09iamVjdCk7XG4gIHJpZ2h0ID0gZGVlcENsb25lKHNpbmtPYmplY3QpO1xuICBsZWZ0Lm9wcy5wdXNoKHN0YXJ0c3dpdGhfZXhwbG9pdF8xKTtcbiAgcmlnaHQub3BzLnB1c2goZW5kc3dpdGhfZXhwbG9pdF8xKTtcblxuICBsZXQgZXhwXzEgPSB7dHlwZTogJ0xvZ2ljYWwnLCBvcDogJyYmJywgbF92YWw6IGxlZnQsIHJfdmFsOiByaWdodH07XG4gIGV4cGxvaXRzLnNldChub25jZV8xLCBleHBfMSk7XG5cbiAgbGV0IHN0YXJ0c3dpdGhfZXhwbG9pdF8yID0ge1xuICAgIFwidHlwZVwiOiBcIm1lbWJlcl9mdW5jdGlvblwiLFxuICAgIFwiZnVuY3Rpb25fbmFtZVwiOiBcInN0YXJ0c1dpdGhcIixcbiAgICBcImFyZ3NcIjogW1xuICAgICAgJyhfX2NyYXdseV9fKFwiJyArIG5vbmNlXzIgKyAnXCIpLyonXG4gICAgXVxuICB9O1xuICBsZXQgZW5kc3dpdGhfZXhwbG9pdF8yID0ge1xuICAgIFwidHlwZVwiOiBcIm1lbWJlcl9mdW5jdGlvblwiLFxuICAgIFwiZnVuY3Rpb25fbmFtZVwiOiBcImVuZHNXaXRoXCIsXG4gICAgXCJhcmdzXCI6IFtcbiAgICAgICcgKi8pJ1xuICAgIF1cbiAgfTtcblxuICBsZWZ0ID0gZGVlcENsb25lKHNpbmtPYmplY3QpO1xuICByaWdodCA9IGRlZXBDbG9uZShzaW5rT2JqZWN0KTtcbiAgbGVmdC5vcHMucHVzaChzdGFydHN3aXRoX2V4cGxvaXRfMik7XG4gIHJpZ2h0Lm9wcy5wdXNoKGVuZHN3aXRoX2V4cGxvaXRfMik7XG5cbiAgbGV0IGV4cF8yID0ge3R5cGU6ICdMb2dpY2FsJywgb3A6ICcmJicsIGxfdmFsOiBsZWZ0LCByX3ZhbDogcmlnaHR9O1xuICBleHBsb2l0cy5zZXQobm9uY2VfMiwgZXhwXzIpO1xuXG4gIGxldCBlbmRzd2l0aF9leHBsb2l0XzMgPSB7XG4gICAgXCJ0eXBlXCI6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgXCJmdW5jdGlvbl9uYW1lXCI6IFwiZW5kc1dpdGhcIixcbiAgICBcImFyZ3NcIjogW1xuICAgICAgJyAqL19fY3Jhd2x5X18oXCInICsgbm9uY2VfMyArICdcIiknXG4gICAgXVxuICB9O1xuICBsZXQgc3RhcnRzd2l0aF9leHBsb2l0XzMgPSB7XG4gICAgXCJ0eXBlXCI6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgXCJmdW5jdGlvbl9uYW1lXCI6IFwic3RhcnRzV2l0aFwiLFxuICAgIFwiYXJnc1wiOiBbXG4gICAgICAnLyonXG4gICAgXVxuICB9O1xuXG4gIGxlZnQgPSBkZWVwQ2xvbmUoc2lua09iamVjdCk7XG4gIHJpZ2h0ID0gZGVlcENsb25lKHNpbmtPYmplY3QpO1xuICBsZWZ0Lm9wcy5wdXNoKHN0YXJ0c3dpdGhfZXhwbG9pdF8zKTtcbiAgcmlnaHQub3BzLnB1c2goZW5kc3dpdGhfZXhwbG9pdF8zKTtcblxuICBsZXQgZXhwXzMgPSB7dHlwZTogJ0xvZ2ljYWwnLCBvcDogJyYmJywgbF92YWw6IGxlZnQsIHJfdmFsOiByaWdodH07XG4gIGV4cGxvaXRzLnNldChub25jZV8zLCBleHBfMyk7XG5cbiAgbGV0IGthbWVlbGVvbiA9IGRlZXBDbG9uZShzaW5rT2JqZWN0KTtcbiAga2FtZWVsZW9uLm9wcy5wdXNoKHtcbiAgICB0eXBlOiBcIkJpbmFyeVwiLFxuICAgIG9wOiAnPT09JyxcbiAgICBzaWRlOiAnbGVmdCcsXG4gICAgdmFsOiAnS2FtZWxlb29uPTEsX19jcmF3bHlfXyhcIicgKyBub25jZV80ICsgJ1wiKSdcbiAgfSk7XG5cbiAgZXhwbG9pdHMuc2V0KG5vbmNlXzQsIGthbWVlbGVvbik7XG5cbiAgbGV0IHN0YXJ0c1dpdGhGaXhPYmplY3QgPSBkZWVwQ2xvbmUoc2lua09iamVjdCk7XG4gIHN0YXJ0c1dpdGhGaXhPYmplY3Qub3BzLnB1c2goe1xuICAgIHR5cGU6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgZnVuY3Rpb25fbmFtZTogXCJlbmRzV2l0aFwiLFxuICAgIGFyZ3M6IFsnLnRvU3RyaW5nKCksX19jcmF3bHlfXyhcIicgKyBub25jZV81ICsgJ1wiKSddXG4gIH0pO1xuXG4gIGV4cGxvaXRzLnNldChub25jZV81LCBzdGFydHNXaXRoRml4T2JqZWN0KTtcblxuICBsZXQgc3RhcnRzV2l0aEFzc2lnbmVtZW50ID0gZGVlcENsb25lKHNpbmtPYmplY3QpO1xuICBzdGFydHNXaXRoQXNzaWduZW1lbnQub3BzLnB1c2goe1xuICAgIHR5cGU6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgZnVuY3Rpb25fbmFtZTogXCJlbmRzV2l0aFwiLFxuICAgIGFyZ3M6IFsnMTtfX2NyYXdseV9fKFwiJyArIG5vbmNlXzYgKyAnXCIpOyddXG4gIH0pO1xuXG4gIGV4cGxvaXRzLnNldChub25jZV82LCBzdGFydHNXaXRoQXNzaWduZW1lbnQpO1xuXG4gIGxldCBzdGFydHNXaXRoQXNzaWduZW1lbnRXaXRob3V0RXF1YWwgPSBkZWVwQ2xvbmUoc2lua09iamVjdCk7XG4gIHN0YXJ0c1dpdGhBc3NpZ25lbWVudFdpdGhvdXRFcXVhbC5vcHMucHVzaCh7XG4gICAgdHlwZTogXCJtZW1iZXJfZnVuY3Rpb25cIixcbiAgICBmdW5jdGlvbl9uYW1lOiBcImVuZHNXaXRoXCIsXG4gICAgYXJnczogWyc9MTtfX2NyYXdseV9fKFwiJyArIG5vbmNlXzcgKyAnXCIpOyddXG4gIH0pO1xuXG4gIGV4cGxvaXRzLnNldChub25jZV83LCBzdGFydHNXaXRoQXNzaWduZW1lbnRXaXRob3V0RXF1YWwpO1xuXG5cbiAgbGV0IGVuZHNXaXRoYW55dGhpbmcgPSBkZWVwQ2xvbmUoc2lua09iamVjdCk7XG4gIGVuZHNXaXRoYW55dGhpbmcub3BzLnB1c2goe1xuICAgIHR5cGU6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgZnVuY3Rpb25fbmFtZTogXCJzdGFydHNXaXRoXCIsXG4gICAgYXJnczogWydfX2NyYXdseV9fKFwiJyArIG5vbmNlXzggKyAnXCIpOy8vJ11cbiAgfSk7XG5cbiAgZXhwbG9pdHMuc2V0KG5vbmNlXzgsIGVuZHNXaXRoYW55dGhpbmcpO1xuXG4gIGxldCB3cmFwcGVkX2Z1bmN0aW9uID0gZGVlcENsb25lKHNpbmtPYmplY3QpO1xuICB3cmFwcGVkX2Z1bmN0aW9uLm9wcy5wdXNoKHtcbiAgICBcInR5cGVcIjogXCJtZW1iZXJfZnVuY3Rpb25cIixcbiAgICBcImZ1bmN0aW9uX25hbWVcIjogXCJzdGFydHNXaXRoXCIsXG4gICAgXCJhcmdzXCI6IFtcbiAgICAgICcoZnVuY3Rpb24oKXtfX2NyYXdseV9fKFwiJyArIG5vbmNlXzkgKyAnXCIpfSkoKTsvLydcbiAgICBdXG4gIH0pO1xuICBleHBsb2l0cy5zZXQobm9uY2VfOSwgd3JhcHBlZF9mdW5jdGlvbik7XG5cbiAgcmV0dXJuIGV4cGxvaXRzO1xuXG59XG5cbmZ1bmN0aW9uIGdldFN0b3JhZ2VFeHBsb2l0cyhrZXlfb2JqLCB2YWxfb2JqKSB7XG4gIGxldCBleHBsb2l0cyA9IG5ldyBNYXAoKTtcbiAgbGV0IG5vbmNlXzEgPSByYW5kb21TdHJpbmcoKTtcblxuICBsZXQga2V5X2NvbnN0ID0gZGVlcENsb25lKGtleV9vYmopO1xuICBsZXQgdmFsX2NvbnN0ID0gZGVlcENsb25lKHZhbF9vYmopO1xuXG4gIGtleV9jb25zdC5vcHMucHVzaCh7XG4gICAgXCJ0eXBlXCI6IFwiQmluYXJ5XCIsXG4gICAgXCJvcFwiOiAnPT09JyxcbiAgICBcInNpZGVcIjogXCJsZWZ0XCIsXG4gICAgXCJ2YWxcIjogbm9uY2VfMVxuICB9KTtcblxuICB2YWxfY29uc3Qub3BzLnB1c2goe1xuICAgIFwidHlwZVwiOiBcIkJpbmFyeVwiLFxuICAgIFwib3BcIjogJz09PScsXG4gICAgXCJzaWRlXCI6IFwibGVmdFwiLFxuICAgIFwidmFsXCI6IG5vbmNlXzFcbiAgfSk7XG5cbiAgZXhwbG9pdHMuc2V0KG5vbmNlXzEsIHtcbiAgICBcInR5cGVcIjogXCJMb2dpY2FsXCIsXG4gICAgXCJvcFwiOiAnJiYnLFxuICAgIFwibF92YWxcIjoga2V5X2NvbnN0LFxuICAgIFwicl92YWxcIjogdmFsX2NvbnN0XG4gIH0pO1xuXG4gIHJldHVybiBleHBsb2l0c1xufVxuXG5mdW5jdGlvbiBnZXRIVE1MRXhwbG9pdHMoc2lua09iamVjdCkge1xuICBsZXQgZXhwbG9pdHMgPSBuZXcgTWFwKCk7XG5cbiAgbGV0IG5vbmNlXzEgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IGV4cDEgPSBkZWVwQ2xvbmUoc2lua09iamVjdClcbiAgbGV0IGltZ19wYXlsb2FkID0gJzxpbWcgc3JjPVwiZm9vXCIgb25lcnJvcj1cIl9fY3Jhd2x5X18oYF9fcmVwb3J0X2lkYClcIiBvbmxvYWQ9XCJfX2NyYXdseV9fKGBfX3JlcG9ydF9pZGApXCI+PHRleHRhcmVhPic7XG4gIGV4cDEub3BzLnB1c2goe1xuICAgIFwidHlwZVwiOiBcIm1lbWJlcl9mdW5jdGlvblwiLFxuICAgIFwiZnVuY3Rpb25fbmFtZVwiOiBcImluZGV4T2ZcIixcbiAgICBcImFyZ3NcIjogW2ltZ19wYXlsb2FkLnJlcGxhY2UoL19fcmVwb3J0X2lkL2csIG5vbmNlXzEpXSxcbiAgfSk7XG4gIGV4cDEub3BzLnB1c2goe3R5cGU6ICdCaW5hcnknLCBvcDogJz4nLCBzaWRlOiAnbGVmdCcsIHZhbDogMH0pXG4gIGV4cGxvaXRzLnNldChub25jZV8xLCBleHAxKVxuICBsZXQgbm9uY2VfMyA9IHJhbmRvbVN0cmluZygpO1xuICBsZXQgZXhwMyA9IGRlZXBDbG9uZShzaW5rT2JqZWN0KTtcbiAgbGV0IHBvbHlnbG90ID0gXCJgJ1xcXCI+LS0hPjwvc3RZbGUvPC90aXRMZS88L3RlWHRhckVhLzwvc2NSaXB0Lz48aW1nL3NyYz1mb28gb05sb0FkPV9fY3Jhd2x5X18oYF9fcmVwb3J0X2lkYCkvLz5cXHgzZVxcblwiO1xuICBleHAzLm9wcy5wdXNoKHtcbiAgICBcInR5cGVcIjogXCJtZW1iZXJfZnVuY3Rpb25cIixcbiAgICBcImZ1bmN0aW9uX25hbWVcIjogXCJpbmRleE9mXCIsXG4gICAgXCJhcmdzXCI6IFtwb2x5Z2xvdC5yZXBsYWNlKC9fX3JlcG9ydF9pZC9nLCBub25jZV8zKV0sXG4gIH0pO1xuICBleHAzLm9wcy5wdXNoKHt0eXBlOiAnQmluYXJ5Jywgb3A6ICc+Jywgc2lkZTogJ2xlZnQnLCB2YWw6IDB9KTtcbiAgZXhwbG9pdHMuc2V0KG5vbmNlXzMsIGV4cDMpO1xuXG5cbiAgcmV0dXJuIGV4cGxvaXRzXG5cbn1cblxuZnVuY3Rpb24gZ2V0T3JpZ2luQ29uc3RyYWludHMoKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0xvZ2ljYWwnLCBvcDogJ3x8JywgbF92YWw6IHtcbiAgICAgIFwib3BzXCI6IFtcbiAgICAgICAge1xuICAgICAgICAgIFwidHlwZVwiOiBcIm9wc19vbl9wYXJlbnRfZWxlbWVudFwiLFxuICAgICAgICAgIFwib2xkX2lkZW50aWZpZXJcIjogXCJldmVudFwiLFxuICAgICAgICAgIFwib2xkX29wc1wiOiBbXVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgXCJ0eXBlXCI6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgICAgICAgXCJmdW5jdGlvbl9uYW1lXCI6IFwic3Vic3RyaW5nXCIsXG4gICAgICAgICAgXCJhcmdzXCI6IFtcbiAgICAgICAgICAgIDAsIDdcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBcInR5cGVcIjogJ0JpbmFyeScsXG4gICAgICAgICAgXCJzaWRlXCI6IFwibGVmdFwiLFxuICAgICAgICAgIFwidmFsXCI6IFwiaHR0cDovL1wiLFxuICAgICAgICAgIFwib3BcIjogJz09PSdcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIFwiaWRlbnRpZmllclwiOiBcImV2ZW50Lm9yaWdpblwiXG4gICAgfSwgcl92YWw6IHtcbiAgICAgIFwib3BzXCI6IFtcbiAgICAgICAge1xuICAgICAgICAgIFwidHlwZVwiOiBcIm9wc19vbl9wYXJlbnRfZWxlbWVudFwiLFxuICAgICAgICAgIFwib2xkX2lkZW50aWZpZXJcIjogXCJldmVudFwiLFxuICAgICAgICAgIFwib2xkX29wc1wiOiBbXVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgXCJ0eXBlXCI6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgICAgICAgXCJmdW5jdGlvbl9uYW1lXCI6IFwic3Vic3RyaW5nXCIsXG4gICAgICAgICAgXCJhcmdzXCI6IFtcbiAgICAgICAgICAgIDAsIDhcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBcInR5cGVcIjogJ0JpbmFyeScsXG4gICAgICAgICAgXCJzaWRlXCI6IFwibGVmdFwiLFxuICAgICAgICAgIFwidmFsXCI6IFwiaHR0cHM6Ly9cIixcbiAgICAgICAgICBcIm9wXCI6ICc9PT0nXG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgICBcImlkZW50aWZpZXJcIjogXCJldmVudC5vcmlnaW5cIlxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRDb29raWVFeHBsb2l0cyhzaW5rT2JqZWN0KSB7XG4gIGxldCBub25jZTEgPSByYW5kb21TdHJpbmcoKTtcbiAgbGV0IGV4cGxvaXRzID0gbmV3IE1hcCgpO1xuXG5cbiAgbGV0IGNvbnN0cmFpbnRzID0gZGVlcENsb25lKHNpbmtPYmplY3QpO1xuICBjb25zdHJhaW50cy5vcHMucHVzaCh7XG4gICAgXCJ0eXBlXCI6IFwibWVtYmVyX2Z1bmN0aW9uXCIsXG4gICAgXCJmdW5jdGlvbl9uYW1lXCI6IFwic3RhcnRzV2l0aFwiLFxuICAgIFwiYXJnc1wiOiBbbm9uY2UxICsgJz0nICsgbm9uY2UxICsgJzsnXVxuICB9KTtcbiAgZXhwbG9pdHMuc2V0KG5vbmNlMSwgY29uc3RyYWludHMpO1xuXG4gIHJldHVybiBleHBsb2l0c1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUV4cGxvaXRGb3JSZXBvcnQocmVwb3J0LCBoYW5kbGVyX2lkKSB7XG4gIGNvbnNvbGUubG9nKCc9PT09PT09PT09PT09Jyk7XG4gIGNvbnNvbGUubG9nKCdTdGFydGluZyBleHBsb2l0IGdlbmVyYXRpb24gZm9yICcsIHJlcG9ydCk7XG4gIGxldCBpbmZlcnJlZF90eXBlcyA9IHt9O1xuICB0cnkge1xuICAgIC8vaW5mZXJyZWRfdHlwZXMgPSBpbmZlclR5cGVzKHJlcG9ydC5ldilcbiAgICBpbmZlcnJlZF90eXBlcyA9IHJlcG9ydC50eXBlSW5mbztcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHdoZW4gaW5mZXJpbmcgdHlwZXMnLCBlKVxuICB9XG4gIGxldCBzaW5rX29ial9jb25zdHJhaW50cztcbiAgc3dpdGNoIChTSU5LX01BUFBJTkdbcmVwb3J0LnNpbmtdKSB7XG4gICAgY2FzZSAnSlMnOlxuICAgICAgc2lua19vYmpfY29uc3RyYWludHMgPSBnZXRKU0V4cGxvaXRzKHJlcG9ydC5zaW5rT2JqZWN0KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ0hUTUwnOlxuICAgICAgc2lua19vYmpfY29uc3RyYWludHMgPSBnZXRIVE1MRXhwbG9pdHMocmVwb3J0LnNpbmtPYmplY3QpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3RvcmFnZSc6XG4gICAgICBzaW5rX29ial9jb25zdHJhaW50cyA9IGdldFN0b3JhZ2VFeHBsb2l0cyhyZXBvcnQua2V5X29iaiwgcmVwb3J0LnZhbF9vYmopO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnY29va2llJzpcbiAgICAgIHNpbmtfb2JqX2NvbnN0cmFpbnRzID0gZ2V0Q29va2llRXhwbG9pdHMocmVwb3J0LnNpbmtPYmplY3QpO1xuICAgICAgYnJlYWs7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgRXJyb3IoJ1Npbmsgbm90IHlldCBzdXBwb3J0ZWQgJyArIHJlcG9ydC5zaW5rKVxuICB9XG5cbiAgbGV0IGNzID0gcmVwb3J0Wydjb25zdHJhaW50cyddO1xuICBsZXQgY29uc3RyYWludElkID0gYXdhaXQgd2luZG93Ll9fcmVwb3J0QmFzZUNvbnN0cmFpbnQoY3MsIGhhbmRsZXJfaWQpO1xuXG4gIGxldCBvcmlnaW5fY29uc3RyYWludCA9IGdldE9yaWdpbkNvbnN0cmFpbnRzKCk7XG4gIGxldCBleHBsb2l0X2NhbmRpZGF0ZXMgPSBbXTtcbiAgZm9yIChsZXQgZXhwbG9pdElkIG9mIHNpbmtfb2JqX2NvbnN0cmFpbnRzLmtleXMoKSkge1xuICAgIGxldCBjYW5kaWRhdGUgPSBzaW5rX29ial9jb25zdHJhaW50cy5nZXQoZXhwbG9pdElkKTtcbiAgICBsZXQgY3NfY2xvbmVkID0gZGVlcENsb25lKGNzKTtcbiAgICAvLyBhcHBlbmQgZXhwbG9pdCBjb25zdHJhaW50c1xuICAgIGNzX2Nsb25lZC5wdXNoKGNhbmRpZGF0ZSk7XG4gICAgLy8gYXBwZW5kIGNvbnN0cmFpbnRzIGZvciBvcmlnaW4sIGUuZy4gc3RhcnRzIHdpdGggaHR0cCBldGNcbiAgICBjc19jbG9uZWQucHVzaChvcmlnaW5fY29uc3RyYWludCk7XG4gICAgLy8gc29sdmVcbiAgICBsZXQgcmVzID0gYXdhaXQgd2luZG93Ll9fdHJ5U29sdmVGb3JTYXQoY3NfY2xvbmVkLCBpbmZlcnJlZF90eXBlcywgY29uc3RyYWludElkLCBbY2FuZGlkYXRlLCBvcmlnaW5fY29uc3RyYWludF0sIHJlcG9ydFsnc2luayddKTtcbiAgICBpZiAocmVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGV4cGxvaXRfY2FuZGlkYXRlcy5wdXNoKHtleHBsb2l0Q2FuZGlkYXRlSWQ6IHJlc1sxXSwgZXhwbG9pdElkOiBleHBsb2l0SWQsIHBheWxvYWRfc2F0OiByZXNbMF19KTtcbiAgICB9XG4gIH1cbiAgaWYgKGV4cGxvaXRfY2FuZGlkYXRlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkXG4gIH1cbiAgbGV0IG1lc3NhZ2VzID0gW107XG4gIGZvciAobGV0IGVudHJ5IG9mIGV4cGxvaXRfY2FuZGlkYXRlcykge1xuICAgIGxldCBtZXNzMSA9IGdlbmVyYXRlT2JqZWN0RnJvbUFzc2lnbmVtZW50cyhlbnRyeVsncGF5bG9hZF9zYXQnXVsnYXNzaWduZW1lbnRzJ10pWydldmVudCddO1xuICAgIGxldCBtZXNzMiA9IGdlbmVyYXRlT2JqZWN0RnJvbUFzc2lnbmVtZW50cyhlbnRyeVsncGF5bG9hZF9zYXQnXVsnYXNzaWduZW1lbnRzJ10sIHVuZGVmaW5lZCwgZmFsc2UpWydldmVudCddO1xuICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgZXhwbG9pdElkOiBlbnRyeVsnZXhwbG9pdElkJ10sXG4gICAgICBleHBsb2l0Q2FuZGlkYXRlSWQ6IGVudHJ5WydleHBsb2l0Q2FuZGlkYXRlSWQnXSxcbiAgICAgIG1lc3NhZ2U6IGFkanVzdEZvclR5cGVzKG1lc3MxLCBlbnRyeVsncGF5bG9hZF9zYXQnXVsndHlwZXMnXSlcbiAgICB9KTtcbiAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgIGV4cGxvaXRJZDogZW50cnlbJ2V4cGxvaXRJZCddLFxuICAgICAgZXhwbG9pdENhbmRpZGF0ZUlkOiBlbnRyeVsnZXhwbG9pdENhbmRpZGF0ZUlkJ10sXG4gICAgICBtZXNzYWdlOiBhZGp1c3RGb3JUeXBlcyhtZXNzMiwgZW50cnlbJ3BheWxvYWRfc2F0J11bJ3R5cGVzJ10pXG4gICAgfSk7XG5cbiAgfVxuICByZXR1cm4ge1xuICAgIGNhbmRpZGF0ZXM6IG1lc3NhZ2VzLFxuICAgIHNpbms6IHJlcG9ydC5zaW5rXG4gIH07XG59XG5cbmZ1bmN0aW9uIGFkanVzdEZvclR5cGVzKG9iaiwgdHlwZXMpIHtcbiAgZm9yIChsZXQga2V5IG9mIE9iamVjdC5rZXlzKHR5cGVzKSkge1xuICAgIGlmICh0eXBlc1trZXldICE9PSAnSlNPTicpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBsZXQgc3BsaXR0ZWQgPSBrZXkuc3BsaXQoJy4nKTtcbiAgICBsZXQgbGFzdCA9IHNwbGl0dGVkLnNsaWNlKC0xKTtcbiAgICBsZXQgYWNjZXNzb3JzID0gc3BsaXR0ZWQuc2xpY2UoMCwgc3BsaXR0ZWQubGVuZ3RoIC0gMSk7XG4gICAgbGV0IGN1cl9vYmogPSBvYmo7XG4gICAgZm9yIChsZXQgYWNjZXNzb3Igb2YgYWNjZXNzb3JzKSB7XG4gICAgICBpZiAoYWNjZXNzb3Iuc3RhcnRzV2l0aCgnX19lbGVtX18nKSkge1xuICAgICAgICBsZXQgbnVtID0gcGFyc2VJbnQoYWNjZXNzb3Iuc2xpY2UoOCkpO1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY3VyX29iaikpIHtcbiAgICAgICAgfVxuICAgICAgICBhY2Nlc3NvciA9IG51bTtcbiAgICAgIH1cbiAgICAgIGlmIChjdXJfb2JqW2FjY2Vzc29yXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY3VyX29iaiA9IGN1cl9vYmpbYWNjZXNzb3JdO1xuICAgIH1cbiAgICBjdXJfb2JqW2xhc3RdID0gSlNPTi5zdHJpbmdpZnkoY3VyX29ialtsYXN0XSlcbiAgfVxuICByZXR1cm4gb2JqXG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlT2JqZWN0RnJvbUFzc2lnbmVtZW50cyhhc3NpZ25lbWVudCwgb2JqID0gdW5kZWZpbmVkLCBkb250X3VzZV9lbXB0eSA9IHRydWUpIHtcbiAgaWYgKG9iaiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgb2JqID0ge307XG4gIH1cbiAgZm9yIChsZXQga2V5IG9mIE9iamVjdC5rZXlzKGFzc2lnbmVtZW50KSkge1xuICAgIGlmIChkb250X3VzZV9lbXB0eSAmJiBhc3NpZ25lbWVudFtrZXldID09PSAnJykge1xuICAgICAgY29udGludWVcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBhc3NpZ25lbWVudFtrZXldID09PSAnc3RyaW5nJykge1xuICAgICAgYXNzaWduZW1lbnRba2V5XSA9IGFzc2lnbmVtZW50W2tleV0ucmVwbGFjZSgvXFxcXHgoWzAtOUEtRl17Mn0pL2lnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGFyZ3VtZW50c1sxXSwgMTYpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBsZXQgc3BsaXR0ZWQgPSBrZXkuc3BsaXQoJy4nKTtcbiAgICBsZXQgbGFzdCA9IHNwbGl0dGVkLnNsaWNlKC0xKTtcbiAgICBsZXQgYWNjZXNzb3JzID0gc3BsaXR0ZWQuc2xpY2UoMCwgc3BsaXR0ZWQubGVuZ3RoIC0gMSk7XG4gICAgbGV0IGN1cl9vYmogPSBvYmo7XG4gICAgZm9yIChsZXQgYWNjZXNzb3Igb2YgYWNjZXNzb3JzKSB7XG4gICAgICBpZiAoYWNjZXNzb3Iuc3RhcnRzV2l0aCgnX19lbGVtX18nKSkge1xuICAgICAgICBsZXQgbnVtID0gcGFyc2VJbnQoYWNjZXNzb3Iuc2xpY2UoOCkpO1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY3VyX29iaikpIHtcbiAgICAgICAgfVxuICAgICAgICBhY2Nlc3NvciA9IG51bTtcbiAgICAgIH1cbiAgICAgIGlmIChjdXJfb2JqW2FjY2Vzc29yXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGN1cl9vYmpbYWNjZXNzb3JdID0ge307XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhZGRQcm9wVG9PYmooY3VyX29iaiwgYWNjZXNzb3IpO1xuICAgICAgfVxuICAgICAgY3VyX29iaiA9IGN1cl9vYmpbYWNjZXNzb3JdO1xuICAgIH1cbiAgICBpZiAoY3VyX29ialtsYXN0WzBdXSA9PT0gdW5kZWZpbmVkKVxuICAgICAgY3VyX29ialtsYXN0WzBdXSA9IGFzc2lnbmVtZW50W2tleV07XG4gICAgZWxzZSB7XG4gICAgICAvLyB0aGlzIGNhc2Ugb25seSBoYXBwZW5zIHdoZW4gd2UgaGF2ZSBhbiBhc3NpZ25lbWVudCBmb3IgYSBwYXJlbnQgb2JqZWN0IHdoaWNoIGlzIGhvd2V2ZXIgYWxyZWFkeSBhbiBvYmplY3QgdGh1cyB3ZSBjYW5ub3QgZG8gaXRcbiAgICAgIGN1cl9vYmpbbGFzdFswXV1bJ19faG9wZV9mb3JfdGhlX2Jlc3QnXSA9IGFzc2lnbmVtZW50W2tleV1cbiAgICB9XG4gIH1cbiAgcmVzb2x2ZVN1YnN0aXR1dGVWYWxzKG9iaiwgb2JqKTtcbiAgcmV0dXJuIG9iajtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVN1YnN0aXR1dGVWYWxzKG9iaiwgZykge1xuICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBlbGVtID0gcmVzb2x2ZVN1YnN0aXR1dGVWYWxzKG9ialtpXSwgZyk7XG4gICAgICBpZiAoZWxlbSkge1xuICAgICAgICBvYmpbaV0gPSBlbGVtO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqID09PSAnb2JqZWN0Jykge1xuICAgIGZvciAobGV0IGtleSBvZiBPYmplY3Qua2V5cyhvYmopKSB7XG4gICAgICBsZXQgZWxlbSA9IHJlc29sdmVTdWJzdGl0dXRlVmFscyhvYmpba2V5XSwgZyk7XG4gICAgICBpZiAoZWxlbSkge1xuICAgICAgICBvYmpba2V5XSA9IGVsZW1cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIG9iaiA9PT0gJ3N0cmluZycgJiYgb2JqLnN0YXJ0c1dpdGgoJ19fc3Vic3RpdHV0ZV92YWx1ZXNfJykpIHtcbiAgICByZXR1cm4gZ1tvYmpdO1xuICB9XG59XG5cbmV4cG9ydCB7Z2VuZXJhdGVFeHBsb2l0Rm9yUmVwb3J0fVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./ExploitGenerator.js\n");

/***/ }),

/***/ "./ForcedRun.js":
/*!**********************!*\
  !*** ./ForcedRun.js ***!
  \**********************/
/*! exports provided: ForcedRun */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ForcedRun\", function() { return ForcedRun; });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./util.js\");\n/*\nCopyright (C) 2020  Marius Steffens, CISPA\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n\n\nclass ForcedRun {\n  constructor(stage, handler_id, fun) {\n    this.old_stale = new Set();\n    this.stage = stage;//  new Iroh.Stage(`(${code.toString()})(ev)`);\n    this.reports = new Map();\n    this.handler_id = handler_id;\n    this.fun = fun;\n  }\n\n  run() {\n    console.log('========== Starting new round ==========');\n    let ev = Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"makeProxy\"])({\n      origin: '', data: {}, source: {\n        postMessage: function (data, origin) {\n\n        }\n      }\n    }, 'event');\n    this.stage.ForceExecution = this._createAnalysisState(ev);\n    // code takes ev as input\n\n    // arrow functions dont overwrite this => this still bound to the instance of ForcedRun\n    // this function will be called by the instrumented code\n    let __begin_tests = () => {\n      this.stage.ForceExecution.inTest = true;\n      this.stage.ForceExecution.constraintBuffer = undefined;\n    };\n    window.__addTypeInfo = (i, t) => {\n      this.stage.ForceExecution.addTypeInfo(i, t);\n    };\n\n    this.stage.ForceExecution.__leave_tests = () => {\n      this.stage.ForceExecution.inTest = false;\n      let res = this.stage.ForceExecution.getConstraintBuffer();\n      this.stage.ForceExecution.constraintBuffer = undefined;\n      return res;\n    };\n    let isStale = true;\n\n    let __id_to_set, __fun_obj, __fun_code;\n    try {\n      eval(this.stage.script);\n    } catch (e) {\n      let match = e.message.match(/([a-zA-Z0-9]+) is not defined/)\n      if (match) {\n        __id_to_set = match[1];\n        __fun_obj = this.fun;\n        debugger;\n      }\n      if (__fun_code) {\n        isStale = false;\n      } else {\n        // We need to take care that if there was no stale block yet we need to mark the current block as stale\n        this.stage.ForceExecution.stale.add(this.stage.ForceExecution.curBBHash);\n        console.error('Unexpected error from force Execution', e, 'Forcing', this.stage.ForceExecution.curBBHash, 'to be stale now')\n      }\n    }\n    // fun code will be set by debugger when we found the corresponding missing identifier from the other scope\n\n    isStale = isStale && (this.old_stale.size === this.stage.ForceExecution.stale.size);\n    this.old_stale = this.stage.ForceExecution.stale;\n    console.log(this.old_stale, this.stage.ForceExecution.stale);\n    return isStale;\n  }\n\n  _createAnalysisState(ev) {\n    let st = {};\n    st.curBBHash = null;\n    st.BBHashMap = new Map();\n    st.shouldLabelAsStale = true;\n    st.randomValue = Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"randomString\"])();\n    st.pathConstraints = [];\n    st.inTest = false;\n    st.stale = new Set(this.old_stale);\n    st.forcedLoop = new Set();\n    st.typeInfo = new Map();\n    st.ConstraintMap = new Map();\n    st.constraintBuffer = undefined;\n    st.reports = this.reports;\n    st.ev = ev;\n    st.savedFunState = [];\n    st.handler_id = this.handler_id;\n    st.emitConstraint = function (constraint) {\n      this.pathConstraints.push(constraint);\n    };\n    st.popConstraint = function () {\n      this.pathConstraints.pop();\n    };\n\n    st.getConstraintBuffer = function () {\n      if (this.constraintBuffer === undefined) {\n        return undefined;\n      }\n      let buf = undefined;\n      for (let i = this.constraintBuffer.length - 1; i >= 0; i--) {\n        if (buf === undefined) {\n          buf = this.constraintBuffer[i][1];\n        } else {\n          buf = {type: 'Logical', op: this.constraintBuffer[i][0], l_val: this.constraintBuffer[i][1], r_val: buf};\n        }\n      }\n      return buf;\n    };\n\n    st.addTypeInfo = function (identifier, type) {\n      this.typeInfo.set(identifier, type);\n    };\n    st.getTypeInfo = function () {\n      let res = [];\n      for (let k of this.typeInfo.keys()) {\n        res.push([k, this.typeInfo.get(k)])\n      }\n      return res;\n    };\n\n    st.emitLogicalConstraint = function (ops, op, identifier) {\n      if (this.constraintBuffer === undefined) {\n        this.constraintBuffer = [[op, {ops: ops, identifier: identifier}]];\n      } else if (op !== undefined) {\n        this.constraintBuffer.push([op, {ops: ops, identifier: identifier}]);\n      } else {\n        throw Error('Unexpected Behaviour in emit LogicalConstraint')\n      }\n    };\n    st.clearLogicalConstraintBuffer = function () {\n      this.constraintBuffer = undefined;\n    };\n    st.emitSinkAccess = function (p, sink, arg_no, hash, target = 'XSS') {\n      let cur_constraints = Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(this.pathConstraints);\n      for (let savedConstraints of this.savedFunState) {\n        cur_constraints = cur_constraints.concat(Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(savedConstraints))\n      }\n      if (this.constraintBuffer && this.constraintBuffer.length) {\n        cur_constraints.push(Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(this.getConstraintBuffer()))\n      }\n      let ev = this.ev;\n      if (!this.reports.has(hash)) {\n        this.reports.set(hash, [{\n          target: target,\n          sinkObject: Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepCloneProxy\"])(p),\n          arg_no: arg_no,\n          constraints: cur_constraints,\n          sink: sink,\n          ev: ev,\n          typeInfo: this.getTypeInfo(),\n        }])\n      } else {\n        // FIXME: comment this in if we want multiple reports per sink access\n        return;\n        this.reports.get(hash).push({\n          target: target,\n          sinkObject: Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepCloneProxy\"])(p),\n          arg_no: arg_no,\n          constraints: cur_constraints,\n          sink: sink,\n          ev: ev,\n          typeInfo: this.getTypeInfo(),\n        });\n      }\n    };\n    st.emitStorageAccess = function (key_obj, val_obj, hash) {\n      let cur_constraints = Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(this.pathConstraints);\n      for (let savedConstraints of this.savedFunState) {\n        cur_constraints = cur_constraints.concat(Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(savedConstraints))\n      }\n      if (this.constraintBuffer && this.constraintBuffer.length) {\n        cur_constraints.push(Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepClone\"])(this.getConstraintBuffer()))\n      }\n      let ev = this.ev;\n      if (!this.reports.has(hash)) {\n        this.reports.set(hash, [{\n          sink: 'storage',\n          key_obj: Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepCloneProxy\"])(key_obj),\n          val_obj: Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepCloneProxy\"])(val_obj),\n          constraints: cur_constraints,\n          ev: ev,\n          typeInfo: this.getTypeInfo(),\n\n        }])\n      } else {\n        this.reports.get(hash).push({\n          sink: 'storage',\n          key_obj: Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepCloneProxy\"])(key_obj),\n          val_obj: Object(_util_js__WEBPACK_IMPORTED_MODULE_0__[\"deepCloneProxy\"])(val_obj),\n          constraints: cur_constraints,\n          ev: ev,\n          typeInfo: this.getTypeInfo(),\n        });\n      }\n    };\n    return st;\n  }\n\n  retrieveReport() {\n    return this.reports;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9Gb3JjZWRSdW4uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9QTUFuYWx5emVyLy4vRm9yY2VkUnVuLmpzPzE1YWIiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAoQykgMjAyMCAgTWFyaXVzIFN0ZWZmZW5zLCBDSVNQQVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4qL1xuXG5pbXBvcnQge21ha2VQcm94eSwgZGVlcENsb25lLCBkZWVwQ2xvbmVQcm94eSwgcmFuZG9tU3RyaW5nfSBmcm9tICcuL3V0aWwuanMnO1xuXG5jbGFzcyBGb3JjZWRSdW4ge1xuICBjb25zdHJ1Y3RvcihzdGFnZSwgaGFuZGxlcl9pZCwgZnVuKSB7XG4gICAgdGhpcy5vbGRfc3RhbGUgPSBuZXcgU2V0KCk7XG4gICAgdGhpcy5zdGFnZSA9IHN0YWdlOy8vICBuZXcgSXJvaC5TdGFnZShgKCR7Y29kZS50b1N0cmluZygpfSkoZXYpYCk7XG4gICAgdGhpcy5yZXBvcnRzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuaGFuZGxlcl9pZCA9IGhhbmRsZXJfaWQ7XG4gICAgdGhpcy5mdW4gPSBmdW47XG4gIH1cblxuICBydW4oKSB7XG4gICAgY29uc29sZS5sb2coJz09PT09PT09PT0gU3RhcnRpbmcgbmV3IHJvdW5kID09PT09PT09PT0nKTtcbiAgICBsZXQgZXYgPSBtYWtlUHJveHkoe1xuICAgICAgb3JpZ2luOiAnJywgZGF0YToge30sIHNvdXJjZToge1xuICAgICAgICBwb3N0TWVzc2FnZTogZnVuY3Rpb24gKGRhdGEsIG9yaWdpbikge1xuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCAnZXZlbnQnKTtcbiAgICB0aGlzLnN0YWdlLkZvcmNlRXhlY3V0aW9uID0gdGhpcy5fY3JlYXRlQW5hbHlzaXNTdGF0ZShldik7XG4gICAgLy8gY29kZSB0YWtlcyBldiBhcyBpbnB1dFxuXG4gICAgLy8gYXJyb3cgZnVuY3Rpb25zIGRvbnQgb3ZlcndyaXRlIHRoaXMgPT4gdGhpcyBzdGlsbCBib3VuZCB0byB0aGUgaW5zdGFuY2Ugb2YgRm9yY2VkUnVuXG4gICAgLy8gdGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBieSB0aGUgaW5zdHJ1bWVudGVkIGNvZGVcbiAgICBsZXQgX19iZWdpbl90ZXN0cyA9ICgpID0+IHtcbiAgICAgIHRoaXMuc3RhZ2UuRm9yY2VFeGVjdXRpb24uaW5UZXN0ID0gdHJ1ZTtcbiAgICAgIHRoaXMuc3RhZ2UuRm9yY2VFeGVjdXRpb24uY29uc3RyYWludEJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHdpbmRvdy5fX2FkZFR5cGVJbmZvID0gKGksIHQpID0+IHtcbiAgICAgIHRoaXMuc3RhZ2UuRm9yY2VFeGVjdXRpb24uYWRkVHlwZUluZm8oaSwgdCk7XG4gICAgfTtcblxuICAgIHRoaXMuc3RhZ2UuRm9yY2VFeGVjdXRpb24uX19sZWF2ZV90ZXN0cyA9ICgpID0+IHtcbiAgICAgIHRoaXMuc3RhZ2UuRm9yY2VFeGVjdXRpb24uaW5UZXN0ID0gZmFsc2U7XG4gICAgICBsZXQgcmVzID0gdGhpcy5zdGFnZS5Gb3JjZUV4ZWN1dGlvbi5nZXRDb25zdHJhaW50QnVmZmVyKCk7XG4gICAgICB0aGlzLnN0YWdlLkZvcmNlRXhlY3V0aW9uLmNvbnN0cmFpbnRCdWZmZXIgPSB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH07XG4gICAgbGV0IGlzU3RhbGUgPSB0cnVlO1xuXG4gICAgbGV0IF9faWRfdG9fc2V0LCBfX2Z1bl9vYmosIF9fZnVuX2NvZGU7XG4gICAgdHJ5IHtcbiAgICAgIGV2YWwodGhpcy5zdGFnZS5zY3JpcHQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxldCBtYXRjaCA9IGUubWVzc2FnZS5tYXRjaCgvKFthLXpBLVowLTldKykgaXMgbm90IGRlZmluZWQvKVxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIF9faWRfdG9fc2V0ID0gbWF0Y2hbMV07XG4gICAgICAgIF9fZnVuX29iaiA9IHRoaXMuZnVuO1xuICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgIH1cbiAgICAgIGlmIChfX2Z1bl9jb2RlKSB7XG4gICAgICAgIGlzU3RhbGUgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdGFrZSBjYXJlIHRoYXQgaWYgdGhlcmUgd2FzIG5vIHN0YWxlIGJsb2NrIHlldCB3ZSBuZWVkIHRvIG1hcmsgdGhlIGN1cnJlbnQgYmxvY2sgYXMgc3RhbGVcbiAgICAgICAgdGhpcy5zdGFnZS5Gb3JjZUV4ZWN1dGlvbi5zdGFsZS5hZGQodGhpcy5zdGFnZS5Gb3JjZUV4ZWN1dGlvbi5jdXJCQkhhc2gpO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIGVycm9yIGZyb20gZm9yY2UgRXhlY3V0aW9uJywgZSwgJ0ZvcmNpbmcnLCB0aGlzLnN0YWdlLkZvcmNlRXhlY3V0aW9uLmN1ckJCSGFzaCwgJ3RvIGJlIHN0YWxlIG5vdycpXG4gICAgICB9XG4gICAgfVxuICAgIC8vIGZ1biBjb2RlIHdpbGwgYmUgc2V0IGJ5IGRlYnVnZ2VyIHdoZW4gd2UgZm91bmQgdGhlIGNvcnJlc3BvbmRpbmcgbWlzc2luZyBpZGVudGlmaWVyIGZyb20gdGhlIG90aGVyIHNjb3BlXG5cbiAgICBpc1N0YWxlID0gaXNTdGFsZSAmJiAodGhpcy5vbGRfc3RhbGUuc2l6ZSA9PT0gdGhpcy5zdGFnZS5Gb3JjZUV4ZWN1dGlvbi5zdGFsZS5zaXplKTtcbiAgICB0aGlzLm9sZF9zdGFsZSA9IHRoaXMuc3RhZ2UuRm9yY2VFeGVjdXRpb24uc3RhbGU7XG4gICAgY29uc29sZS5sb2codGhpcy5vbGRfc3RhbGUsIHRoaXMuc3RhZ2UuRm9yY2VFeGVjdXRpb24uc3RhbGUpO1xuICAgIHJldHVybiBpc1N0YWxlO1xuICB9XG5cbiAgX2NyZWF0ZUFuYWx5c2lzU3RhdGUoZXYpIHtcbiAgICBsZXQgc3QgPSB7fTtcbiAgICBzdC5jdXJCQkhhc2ggPSBudWxsO1xuICAgIHN0LkJCSGFzaE1hcCA9IG5ldyBNYXAoKTtcbiAgICBzdC5zaG91bGRMYWJlbEFzU3RhbGUgPSB0cnVlO1xuICAgIHN0LnJhbmRvbVZhbHVlID0gcmFuZG9tU3RyaW5nKCk7XG4gICAgc3QucGF0aENvbnN0cmFpbnRzID0gW107XG4gICAgc3QuaW5UZXN0ID0gZmFsc2U7XG4gICAgc3Quc3RhbGUgPSBuZXcgU2V0KHRoaXMub2xkX3N0YWxlKTtcbiAgICBzdC5mb3JjZWRMb29wID0gbmV3IFNldCgpO1xuICAgIHN0LnR5cGVJbmZvID0gbmV3IE1hcCgpO1xuICAgIHN0LkNvbnN0cmFpbnRNYXAgPSBuZXcgTWFwKCk7XG4gICAgc3QuY29uc3RyYWludEJ1ZmZlciA9IHVuZGVmaW5lZDtcbiAgICBzdC5yZXBvcnRzID0gdGhpcy5yZXBvcnRzO1xuICAgIHN0LmV2ID0gZXY7XG4gICAgc3Quc2F2ZWRGdW5TdGF0ZSA9IFtdO1xuICAgIHN0LmhhbmRsZXJfaWQgPSB0aGlzLmhhbmRsZXJfaWQ7XG4gICAgc3QuZW1pdENvbnN0cmFpbnQgPSBmdW5jdGlvbiAoY29uc3RyYWludCkge1xuICAgICAgdGhpcy5wYXRoQ29uc3RyYWludHMucHVzaChjb25zdHJhaW50KTtcbiAgICB9O1xuICAgIHN0LnBvcENvbnN0cmFpbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnBhdGhDb25zdHJhaW50cy5wb3AoKTtcbiAgICB9O1xuXG4gICAgc3QuZ2V0Q29uc3RyYWludEJ1ZmZlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmNvbnN0cmFpbnRCdWZmZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgbGV0IGJ1ZiA9IHVuZGVmaW5lZDtcbiAgICAgIGZvciAobGV0IGkgPSB0aGlzLmNvbnN0cmFpbnRCdWZmZXIubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgaWYgKGJ1ZiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgYnVmID0gdGhpcy5jb25zdHJhaW50QnVmZmVyW2ldWzFdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJ1ZiA9IHt0eXBlOiAnTG9naWNhbCcsIG9wOiB0aGlzLmNvbnN0cmFpbnRCdWZmZXJbaV1bMF0sIGxfdmFsOiB0aGlzLmNvbnN0cmFpbnRCdWZmZXJbaV1bMV0sIHJfdmFsOiBidWZ9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYnVmO1xuICAgIH07XG5cbiAgICBzdC5hZGRUeXBlSW5mbyA9IGZ1bmN0aW9uIChpZGVudGlmaWVyLCB0eXBlKSB7XG4gICAgICB0aGlzLnR5cGVJbmZvLnNldChpZGVudGlmaWVyLCB0eXBlKTtcbiAgICB9O1xuICAgIHN0LmdldFR5cGVJbmZvID0gZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHJlcyA9IFtdO1xuICAgICAgZm9yIChsZXQgayBvZiB0aGlzLnR5cGVJbmZvLmtleXMoKSkge1xuICAgICAgICByZXMucHVzaChbaywgdGhpcy50eXBlSW5mby5nZXQoayldKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcztcbiAgICB9O1xuXG4gICAgc3QuZW1pdExvZ2ljYWxDb25zdHJhaW50ID0gZnVuY3Rpb24gKG9wcywgb3AsIGlkZW50aWZpZXIpIHtcbiAgICAgIGlmICh0aGlzLmNvbnN0cmFpbnRCdWZmZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmNvbnN0cmFpbnRCdWZmZXIgPSBbW29wLCB7b3BzOiBvcHMsIGlkZW50aWZpZXI6IGlkZW50aWZpZXJ9XV07XG4gICAgICB9IGVsc2UgaWYgKG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5jb25zdHJhaW50QnVmZmVyLnB1c2goW29wLCB7b3BzOiBvcHMsIGlkZW50aWZpZXI6IGlkZW50aWZpZXJ9XSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBFcnJvcignVW5leHBlY3RlZCBCZWhhdmlvdXIgaW4gZW1pdCBMb2dpY2FsQ29uc3RyYWludCcpXG4gICAgICB9XG4gICAgfTtcbiAgICBzdC5jbGVhckxvZ2ljYWxDb25zdHJhaW50QnVmZmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jb25zdHJhaW50QnVmZmVyID0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgc3QuZW1pdFNpbmtBY2Nlc3MgPSBmdW5jdGlvbiAocCwgc2luaywgYXJnX25vLCBoYXNoLCB0YXJnZXQgPSAnWFNTJykge1xuICAgICAgbGV0IGN1cl9jb25zdHJhaW50cyA9IGRlZXBDbG9uZSh0aGlzLnBhdGhDb25zdHJhaW50cyk7XG4gICAgICBmb3IgKGxldCBzYXZlZENvbnN0cmFpbnRzIG9mIHRoaXMuc2F2ZWRGdW5TdGF0ZSkge1xuICAgICAgICBjdXJfY29uc3RyYWludHMgPSBjdXJfY29uc3RyYWludHMuY29uY2F0KGRlZXBDbG9uZShzYXZlZENvbnN0cmFpbnRzKSlcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmNvbnN0cmFpbnRCdWZmZXIgJiYgdGhpcy5jb25zdHJhaW50QnVmZmVyLmxlbmd0aCkge1xuICAgICAgICBjdXJfY29uc3RyYWludHMucHVzaChkZWVwQ2xvbmUodGhpcy5nZXRDb25zdHJhaW50QnVmZmVyKCkpKVxuICAgICAgfVxuICAgICAgbGV0IGV2ID0gdGhpcy5ldjtcbiAgICAgIGlmICghdGhpcy5yZXBvcnRzLmhhcyhoYXNoKSkge1xuICAgICAgICB0aGlzLnJlcG9ydHMuc2V0KGhhc2gsIFt7XG4gICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgICAgc2lua09iamVjdDogZGVlcENsb25lUHJveHkocCksXG4gICAgICAgICAgYXJnX25vOiBhcmdfbm8sXG4gICAgICAgICAgY29uc3RyYWludHM6IGN1cl9jb25zdHJhaW50cyxcbiAgICAgICAgICBzaW5rOiBzaW5rLFxuICAgICAgICAgIGV2OiBldixcbiAgICAgICAgICB0eXBlSW5mbzogdGhpcy5nZXRUeXBlSW5mbygpLFxuICAgICAgICB9XSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZJWE1FOiBjb21tZW50IHRoaXMgaW4gaWYgd2Ugd2FudCBtdWx0aXBsZSByZXBvcnRzIHBlciBzaW5rIGFjY2Vzc1xuICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMucmVwb3J0cy5nZXQoaGFzaCkucHVzaCh7XG4gICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgICAgc2lua09iamVjdDogZGVlcENsb25lUHJveHkocCksXG4gICAgICAgICAgYXJnX25vOiBhcmdfbm8sXG4gICAgICAgICAgY29uc3RyYWludHM6IGN1cl9jb25zdHJhaW50cyxcbiAgICAgICAgICBzaW5rOiBzaW5rLFxuICAgICAgICAgIGV2OiBldixcbiAgICAgICAgICB0eXBlSW5mbzogdGhpcy5nZXRUeXBlSW5mbygpLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHN0LmVtaXRTdG9yYWdlQWNjZXNzID0gZnVuY3Rpb24gKGtleV9vYmosIHZhbF9vYmosIGhhc2gpIHtcbiAgICAgIGxldCBjdXJfY29uc3RyYWludHMgPSBkZWVwQ2xvbmUodGhpcy5wYXRoQ29uc3RyYWludHMpO1xuICAgICAgZm9yIChsZXQgc2F2ZWRDb25zdHJhaW50cyBvZiB0aGlzLnNhdmVkRnVuU3RhdGUpIHtcbiAgICAgICAgY3VyX2NvbnN0cmFpbnRzID0gY3VyX2NvbnN0cmFpbnRzLmNvbmNhdChkZWVwQ2xvbmUoc2F2ZWRDb25zdHJhaW50cykpXG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jb25zdHJhaW50QnVmZmVyICYmIHRoaXMuY29uc3RyYWludEJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgY3VyX2NvbnN0cmFpbnRzLnB1c2goZGVlcENsb25lKHRoaXMuZ2V0Q29uc3RyYWludEJ1ZmZlcigpKSlcbiAgICAgIH1cbiAgICAgIGxldCBldiA9IHRoaXMuZXY7XG4gICAgICBpZiAoIXRoaXMucmVwb3J0cy5oYXMoaGFzaCkpIHtcbiAgICAgICAgdGhpcy5yZXBvcnRzLnNldChoYXNoLCBbe1xuICAgICAgICAgIHNpbms6ICdzdG9yYWdlJyxcbiAgICAgICAgICBrZXlfb2JqOiBkZWVwQ2xvbmVQcm94eShrZXlfb2JqKSxcbiAgICAgICAgICB2YWxfb2JqOiBkZWVwQ2xvbmVQcm94eSh2YWxfb2JqKSxcbiAgICAgICAgICBjb25zdHJhaW50czogY3VyX2NvbnN0cmFpbnRzLFxuICAgICAgICAgIGV2OiBldixcbiAgICAgICAgICB0eXBlSW5mbzogdGhpcy5nZXRUeXBlSW5mbygpLFxuXG4gICAgICAgIH1dKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZXBvcnRzLmdldChoYXNoKS5wdXNoKHtcbiAgICAgICAgICBzaW5rOiAnc3RvcmFnZScsXG4gICAgICAgICAga2V5X29iajogZGVlcENsb25lUHJveHkoa2V5X29iaiksXG4gICAgICAgICAgdmFsX29iajogZGVlcENsb25lUHJveHkodmFsX29iaiksXG4gICAgICAgICAgY29uc3RyYWludHM6IGN1cl9jb25zdHJhaW50cyxcbiAgICAgICAgICBldjogZXYsXG4gICAgICAgICAgdHlwZUluZm86IHRoaXMuZ2V0VHlwZUluZm8oKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gc3Q7XG4gIH1cblxuICByZXRyaWV2ZVJlcG9ydCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBvcnRzO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIEZvcmNlZFJ1blxufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./ForcedRun.js\n");

/***/ }),

/***/ "./evaluationHelper.js":
/*!*****************************!*\
  !*** ./evaluationHelper.js ***!
  \*****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/*\nCopyright (c) Royal Holloway, University of London | Contact Blake Loring (blake@parsed.uk), Duncan Mitchell (Duncan.Mitchell.2015@rhul.ac.uk), or Johannes Kinder (johannes.kinder@rhul.ac.uk) for details or support\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\nconst BinaryJumpTable = {\n  \"==\": function(left, right) { return left == right; },\n  \"===\": function(left, right) { return left === right; },\n\n  \"!=\": function(left, right) { return left != right; },\n  \"!==\": function(left, right) { return left !== right; },\n\n  \"<\": function(left, right) { return left < right; },\n  \">\": function(left, right) { return left > right; },\n\n  \"<=\": function(left, right) { return left <= right; },\n  \">=\": function(left, right) { return left >= right; },\n\n  \"+\": function(left, right) { return left + right; },\n  \"-\": function(left, right) { return left - right; },\n\n  \"*\": function(left, right) { return left * right; },\n  \"/\": function(left, right) { return left / right; },\n\n  \"%\": function(left, right) { return left % right; },\n\n  \">>\": function(left, right) { return left >> right; },\n  \"<<\": function(left, right) { return left << right; },\n  \">>>\": function(left, right) { return left >>> right; },\n\n  \"&\": function(left, right) { return left & right; },\n  \"&&\": function(left, right) { return left && right; },\n\n  \"|\": function(l, r) { return l | r; },\n  \"||\": function(l, r) { return l || r; },\n\n  \"^\": function(l, r) { return l ^ r; },\n  \"instanceof\": function(l, r) { return l instanceof r; },\n  \"in\": function(l, r) { return l in r; }\n};\n\nconst UnaryJumpTable = {\n  \"!\": function(v) { return !v; },\n  \"~\": function(v) { return ~v; },\n  \"-\": function(v) { return -v; },\n  \"+\": function(v) { return +v; },\n  \"typeof\": function(v) { return typeof v; },\n  \"void\": function(){return void 0}\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\n  evalBinary: function(op, left, right) {\n    return BinaryJumpTable[op](left, right);\n  },\n\n  evalUnary: function(op, left) {\n    return UnaryJumpTable[op](left);\n  }\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ldmFsdWF0aW9uSGVscGVyLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUE1BbmFseXplci8uL2V2YWx1YXRpb25IZWxwZXIuanM/NGUyOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IChjKSBSb3lhbCBIb2xsb3dheSwgVW5pdmVyc2l0eSBvZiBMb25kb24gfCBDb250YWN0IEJsYWtlIExvcmluZyAoYmxha2VAcGFyc2VkLnVrKSwgRHVuY2FuIE1pdGNoZWxsIChEdW5jYW4uTWl0Y2hlbGwuMjAxNUByaHVsLmFjLnVrKSwgb3IgSm9oYW5uZXMgS2luZGVyIChqb2hhbm5lcy5raW5kZXJAcmh1bC5hYy51aykgZm9yIGRldGFpbHMgb3Igc3VwcG9ydFxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG4qL1xuY29uc3QgQmluYXJ5SnVtcFRhYmxlID0ge1xuICBcIj09XCI6IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7IHJldHVybiBsZWZ0ID09IHJpZ2h0OyB9LFxuICBcIj09PVwiOiBmdW5jdGlvbihsZWZ0LCByaWdodCkgeyByZXR1cm4gbGVmdCA9PT0gcmlnaHQ7IH0sXG5cbiAgXCIhPVwiOiBmdW5jdGlvbihsZWZ0LCByaWdodCkgeyByZXR1cm4gbGVmdCAhPSByaWdodDsgfSxcbiAgXCIhPT1cIjogZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsgcmV0dXJuIGxlZnQgIT09IHJpZ2h0OyB9LFxuXG4gIFwiPFwiOiBmdW5jdGlvbihsZWZ0LCByaWdodCkgeyByZXR1cm4gbGVmdCA8IHJpZ2h0OyB9LFxuICBcIj5cIjogZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsgcmV0dXJuIGxlZnQgPiByaWdodDsgfSxcblxuICBcIjw9XCI6IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7IHJldHVybiBsZWZ0IDw9IHJpZ2h0OyB9LFxuICBcIj49XCI6IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7IHJldHVybiBsZWZ0ID49IHJpZ2h0OyB9LFxuXG4gIFwiK1wiOiBmdW5jdGlvbihsZWZ0LCByaWdodCkgeyByZXR1cm4gbGVmdCArIHJpZ2h0OyB9LFxuICBcIi1cIjogZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsgcmV0dXJuIGxlZnQgLSByaWdodDsgfSxcblxuICBcIipcIjogZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsgcmV0dXJuIGxlZnQgKiByaWdodDsgfSxcbiAgXCIvXCI6IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7IHJldHVybiBsZWZ0IC8gcmlnaHQ7IH0sXG5cbiAgXCIlXCI6IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7IHJldHVybiBsZWZ0ICUgcmlnaHQ7IH0sXG5cbiAgXCI+PlwiOiBmdW5jdGlvbihsZWZ0LCByaWdodCkgeyByZXR1cm4gbGVmdCA+PiByaWdodDsgfSxcbiAgXCI8PFwiOiBmdW5jdGlvbihsZWZ0LCByaWdodCkgeyByZXR1cm4gbGVmdCA8PCByaWdodDsgfSxcbiAgXCI+Pj5cIjogZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsgcmV0dXJuIGxlZnQgPj4+IHJpZ2h0OyB9LFxuXG4gIFwiJlwiOiBmdW5jdGlvbihsZWZ0LCByaWdodCkgeyByZXR1cm4gbGVmdCAmIHJpZ2h0OyB9LFxuICBcIiYmXCI6IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7IHJldHVybiBsZWZ0ICYmIHJpZ2h0OyB9LFxuXG4gIFwifFwiOiBmdW5jdGlvbihsLCByKSB7IHJldHVybiBsIHwgcjsgfSxcbiAgXCJ8fFwiOiBmdW5jdGlvbihsLCByKSB7IHJldHVybiBsIHx8IHI7IH0sXG5cbiAgXCJeXCI6IGZ1bmN0aW9uKGwsIHIpIHsgcmV0dXJuIGwgXiByOyB9LFxuICBcImluc3RhbmNlb2ZcIjogZnVuY3Rpb24obCwgcikgeyByZXR1cm4gbCBpbnN0YW5jZW9mIHI7IH0sXG4gIFwiaW5cIjogZnVuY3Rpb24obCwgcikgeyByZXR1cm4gbCBpbiByOyB9XG59O1xuXG5jb25zdCBVbmFyeUp1bXBUYWJsZSA9IHtcbiAgXCIhXCI6IGZ1bmN0aW9uKHYpIHsgcmV0dXJuICF2OyB9LFxuICBcIn5cIjogZnVuY3Rpb24odikgeyByZXR1cm4gfnY7IH0sXG4gIFwiLVwiOiBmdW5jdGlvbih2KSB7IHJldHVybiAtdjsgfSxcbiAgXCIrXCI6IGZ1bmN0aW9uKHYpIHsgcmV0dXJuICt2OyB9LFxuICBcInR5cGVvZlwiOiBmdW5jdGlvbih2KSB7IHJldHVybiB0eXBlb2YgdjsgfSxcbiAgXCJ2b2lkXCI6IGZ1bmN0aW9uKCl7cmV0dXJuIHZvaWQgMH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgZXZhbEJpbmFyeTogZnVuY3Rpb24ob3AsIGxlZnQsIHJpZ2h0KSB7XG4gICAgcmV0dXJuIEJpbmFyeUp1bXBUYWJsZVtvcF0obGVmdCwgcmlnaHQpO1xuICB9LFxuXG4gIGV2YWxVbmFyeTogZnVuY3Rpb24ob3AsIGxlZnQpIHtcbiAgICByZXR1cm4gVW5hcnlKdW1wVGFibGVbb3BdKGxlZnQpO1xuICB9XG59OyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./evaluationHelper.js\n");

/***/ }),

/***/ "./hook.js":
/*!*****************!*\
  !*** ./hook.js ***!
  \*****************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _Analyzer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Analyzer.js */ \"./Analyzer.js\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util */ \"./util.js\");\n/*\nCopyright (C) 2020  Marius Steffens, CISPA\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n\n\n\n// restrict the page to use history to circumvent navigation lock\nwindow.history.back = () => {\n};\nwindow.history.forward = () => {\n};\n\n(function () {\n  let old_handler = window.addEventListener;\n  window.addEventListener = function (ev, fun) {\n    if (ev === 'message') {\n      old_handler.apply(window, arguments);\n      if (typeof fun !== 'function' || Object(_Analyzer_js__WEBPACK_IMPORTED_MODULE_0__[\"isNativeFunc\"])(fun)) {\n        return\n      }\n      let p = window.__shouldAnalyzeHandler(window.__getContextUrl(window), Object(_util__WEBPACK_IMPORTED_MODULE_1__[\"getFunctionString\"])(fun));\n      p.then(function (handler_id) {\n        console.error('analyzing handler with id', handler_id);\n        if (handler_id) {\n          // this means that the handler was not yet found for this host combination so we should analyze it\n          Object(_Analyzer_js__WEBPACK_IMPORTED_MODULE_0__[\"analyzeHandler\"])(fun, handler_id);\n        }\n      });\n    }\n  }\n})();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ob29rLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUE1BbmFseXplci8uL2hvb2suanM/MWJhNyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IChDKSAyMDIwICBNYXJpdXMgU3RlZmZlbnMsIENJU1BBXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiovXG5cbmltcG9ydCB7YW5hbHl6ZUhhbmRsZXIsIGlzTmF0aXZlRnVuY30gZnJvbSBcIi4vQW5hbHl6ZXIuanNcIjtcbmltcG9ydCB7Z2V0RnVuY3Rpb25TdHJpbmd9IGZyb20gXCIuL3V0aWxcIjtcblxuLy8gcmVzdHJpY3QgdGhlIHBhZ2UgdG8gdXNlIGhpc3RvcnkgdG8gY2lyY3VtdmVudCBuYXZpZ2F0aW9uIGxvY2tcbndpbmRvdy5oaXN0b3J5LmJhY2sgPSAoKSA9PiB7XG59O1xud2luZG93Lmhpc3RvcnkuZm9yd2FyZCA9ICgpID0+IHtcbn07XG5cbihmdW5jdGlvbiAoKSB7XG4gIGxldCBvbGRfaGFuZGxlciA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyO1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIChldiwgZnVuKSB7XG4gICAgaWYgKGV2ID09PSAnbWVzc2FnZScpIHtcbiAgICAgIG9sZF9oYW5kbGVyLmFwcGx5KHdpbmRvdywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0eXBlb2YgZnVuICE9PSAnZnVuY3Rpb24nIHx8IGlzTmF0aXZlRnVuYyhmdW4pKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgbGV0IHAgPSB3aW5kb3cuX19zaG91bGRBbmFseXplSGFuZGxlcih3aW5kb3cuX19nZXRDb250ZXh0VXJsKHdpbmRvdyksIGdldEZ1bmN0aW9uU3RyaW5nKGZ1bikpO1xuICAgICAgcC50aGVuKGZ1bmN0aW9uIChoYW5kbGVyX2lkKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ2FuYWx5emluZyBoYW5kbGVyIHdpdGggaWQnLCBoYW5kbGVyX2lkKTtcbiAgICAgICAgaWYgKGhhbmRsZXJfaWQpIHtcbiAgICAgICAgICAvLyB0aGlzIG1lYW5zIHRoYXQgdGhlIGhhbmRsZXIgd2FzIG5vdCB5ZXQgZm91bmQgZm9yIHRoaXMgaG9zdCBjb21iaW5hdGlvbiBzbyB3ZSBzaG91bGQgYW5hbHl6ZSBpdFxuICAgICAgICAgIGFuYWx5emVIYW5kbGVyKGZ1biwgaGFuZGxlcl9pZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSkoKTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./hook.js\n");

/***/ }),

/***/ "./util.js":
/*!*****************!*\
  !*** ./util.js ***!
  \*****************/
/*! exports provided: makeProxy, deepClone, deepCloneMap, deepCloneProxy, randomString, delay, deProxifyArguments, isProxy, getFunctionString */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"makeProxy\", function() { return makeProxy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deepClone\", function() { return deepClone; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deepCloneMap\", function() { return deepCloneMap; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deepCloneProxy\", function() { return deepCloneProxy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"randomString\", function() { return randomString; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"delay\", function() { return delay; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deProxifyArguments\", function() { return deProxifyArguments; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isProxy\", function() { return isProxy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getFunctionString\", function() { return getFunctionString; });\n/*\nCopyright (C) 2020  Marius Steffens, CISPA\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nfunction makeProxy(obj, identifier, appliedOperations = [], isRealValue = false) {\n  // Wrap a primitive type to be proxy compatible\n  if (typeof obj !== 'object' || obj === null) {\n    obj = {\"__is_primitive_value\": true, \"__real_primitive_value\": obj}\n  }\n  obj.__identifier = identifier;\n  if (obj.__applied_ops) {\n    obj.__applied_ops = obj.__applied_ops.concat(appliedOperations);\n  } else {\n    obj.__applied_ops = appliedOperations;\n  }\n\n  let handler = {\n    get: function (target, key, receiver) {\n      if (typeof obj === 'object' && Object.keys(target).length === 2 && '__identifier' in target && '__applied_ops' in target) {\n        // This means we are uncertain whether this thing here is really a object or if it is supposed to be e.g. a string\n        if (key === Symbol.iterator) {\n          window.__addTypeInfo(identifier, 'array');\n          // this should work for array usage as well as dict usage\n          obj.__is_primitive_value = true;\n          obj.__real_primitive_value = [];\n          obj[Symbol.iterator] = function* () {\n            let i = 0;\n            while (i < 5) {\n              let ops = deepClone(appliedOperations);\n              ops.push({'type': 'iterator', 'accessed_elem': i++});\n              yield makeProxy({}, identifier, ops);\n            }\n            yield undefined\n          };\n        } else if (key in String.prototype) {\n          // guess that this should in fact not be a object but rather a string. thus adapt it to be a primitive object.\n          obj.__is_primitive_value = true;\n          obj.__real_primitive_value = '';\n        } else if (key in Number.prototype) {\n          // guess that this should in fact not be a object but rather a string. thus adapt it to be a primitive object.\n          obj.__is_primitive_value = true;\n          obj.__real_primitive_value = '';\n        }\n\n      }\n      if (key === '__is_real_value') {\n        return isRealValue;\n      }\n      if (key === '__get_identifier') {\n        return identifier;\n      }\n      if (key === '__get_ops') {\n        return appliedOperations;\n      }\n      if (key === '__get_real_obj') {\n        if (target.__is_primitive_value) {\n          return target.__real_primitive_value;\n        }\n        return target;\n      }\n      if (key === '__is_proxy') {\n        return true;\n      }\n      if (typeof key === 'symbol') {\n        return target[key];\n      }\n      let accessed;\n\n      if (key === 'valueOf' || key === 'toString' && this.__is_primitive_value) {\n        return () => {\n          return this.__real_primitive_value;\n        }\n      }\n\n      if (target[\"__is_primitive_value\"]) {\n        target = target[\"__real_primitive_value\"];\n        accessed = target[key];\n\n      } else {\n        accessed = Reflect.get(target, key, receiver);\n      }\n\n      //if (accessed === undefined) {\n      //  return undefined;\n      //}\n      // TODO: check if accessed is undefined and handle this appropriately\n\n      // We need this for implicit conversion, e.g. when == is used and types missmatch since our values will always be proxies and does provoke implicit conversions.\n      // However we do not want to loose precision, when toString is called by the developer which is why we retaint it after a function call to toString or valueOf\n      if (key === 'valueOf' || key === 'toString') {\n        return function () {\n          /*ignore_this_func*/\n          return accessed.apply(target, arguments);\n        }\n      }\n      if (typeof accessed === 'function') {\n        return function () {\n          return accessed.apply(target, arguments);\n        }\n      } else {\n        // this is the case when we retrieve a property, we want to note that we are now accessing a sub property and\n        // if (accessed === undefined && identifier === 'event') {\n        //   return undefined\n        // }\n        if (accessed === undefined) {\n          target[key] = {};\n          accessed = target[key];\n        }\n        if (isProxy(accessed)) {\n          return accessed;\n        }\n        return makeProxy(accessed, identifier + '.' + key.toString(), [{\n          type: 'ops_on_parent_element',\n          old_identifier: identifier,\n          old_ops: deepClone(appliedOperations)\n        }]);\n      }\n    },\n\n    set: function (target, key, value, receiver) {\n      console.log('setting', key, 'to', value, 'on', target);\n      return Reflect.set(target, key, value, receiver);\n    }\n  };\n  return new Proxy(obj, handler);\n}\n\nfunction deepCloneMap(map) {\n  let m = new Map();\n\n  for (const [key, value] of map.entries()) {\n    m.set(key, deepClone(value));\n  }\n  return m;\n}\n\nfunction deepClone(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nfunction deepCloneProxy(proxy) {\n  let identifier = proxy.__get_identifier;\n  let last_ops = proxy.__get_ops;\n  let real_value = proxy.__get_real_obj;\n\n  return {identifier: identifier, ops: last_ops, value: real_value}\n}\n\nfunction randomString(length = 20) {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let res = '';\n  for (let i = 0; i < length; i++)\n    res += chars.charAt(Math.floor(Math.random() * chars.length));\n  return res;\n}\n\n\nfunction delay(timeout) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, timeout);\n  });\n}\n\nfunction deProxifyArguments(args) {\n  let res;\n  if (Array.isArray(args)) {\n    res = [];\n    for (let arg of args) {\n      arg = deProxifyArguments(arg);\n      res.push(arg);\n    }\n  } else if (args === undefined) {\n\n  } else if (isProxy(args)) {\n    res = {ops: args.__get_ops, identifier: args.__get_identifier};\n  } else if (args.__proto__ === RegExp.prototype) {\n    let regex = args.toString();\n    res = regex.slice(1).slice(0, regex.lastIndexOf('/') - 1)\n  } else {\n    res = args;\n  }\n\n  return res\n}\n\nfunction isProxy(obj) {\n  if (obj === window || obj === parent || obj === window.opener) {\n    return false\n  }\n  return obj !== null && typeof obj === 'object' && obj.__is_proxy;\n}\n\nfunction getFunctionString(fun) {\n  return (function () {\n  }).toString.apply(fun);\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi91dGlsLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vUE1BbmFseXplci8uL3V0aWwuanM/OTQxNSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IChDKSAyMDIwICBNYXJpdXMgU3RlZmZlbnMsIENJU1BBXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiovXG5cbmZ1bmN0aW9uIG1ha2VQcm94eShvYmosIGlkZW50aWZpZXIsIGFwcGxpZWRPcGVyYXRpb25zID0gW10sIGlzUmVhbFZhbHVlID0gZmFsc2UpIHtcbiAgLy8gV3JhcCBhIHByaW1pdGl2ZSB0eXBlIHRvIGJlIHByb3h5IGNvbXBhdGlibGVcbiAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCkge1xuICAgIG9iaiA9IHtcIl9faXNfcHJpbWl0aXZlX3ZhbHVlXCI6IHRydWUsIFwiX19yZWFsX3ByaW1pdGl2ZV92YWx1ZVwiOiBvYmp9XG4gIH1cbiAgb2JqLl9faWRlbnRpZmllciA9IGlkZW50aWZpZXI7XG4gIGlmIChvYmouX19hcHBsaWVkX29wcykge1xuICAgIG9iai5fX2FwcGxpZWRfb3BzID0gb2JqLl9fYXBwbGllZF9vcHMuY29uY2F0KGFwcGxpZWRPcGVyYXRpb25zKTtcbiAgfSBlbHNlIHtcbiAgICBvYmouX19hcHBsaWVkX29wcyA9IGFwcGxpZWRPcGVyYXRpb25zO1xuICB9XG5cbiAgbGV0IGhhbmRsZXIgPSB7XG4gICAgZ2V0OiBmdW5jdGlvbiAodGFyZ2V0LCBrZXksIHJlY2VpdmVyKSB7XG4gICAgICBpZiAodHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXModGFyZ2V0KS5sZW5ndGggPT09IDIgJiYgJ19faWRlbnRpZmllcicgaW4gdGFyZ2V0ICYmICdfX2FwcGxpZWRfb3BzJyBpbiB0YXJnZXQpIHtcbiAgICAgICAgLy8gVGhpcyBtZWFucyB3ZSBhcmUgdW5jZXJ0YWluIHdoZXRoZXIgdGhpcyB0aGluZyBoZXJlIGlzIHJlYWxseSBhIG9iamVjdCBvciBpZiBpdCBpcyBzdXBwb3NlZCB0byBiZSBlLmcuIGEgc3RyaW5nXG4gICAgICAgIGlmIChrZXkgPT09IFN5bWJvbC5pdGVyYXRvcikge1xuICAgICAgICAgIHdpbmRvdy5fX2FkZFR5cGVJbmZvKGlkZW50aWZpZXIsICdhcnJheScpO1xuICAgICAgICAgIC8vIHRoaXMgc2hvdWxkIHdvcmsgZm9yIGFycmF5IHVzYWdlIGFzIHdlbGwgYXMgZGljdCB1c2FnZVxuICAgICAgICAgIG9iai5fX2lzX3ByaW1pdGl2ZV92YWx1ZSA9IHRydWU7XG4gICAgICAgICAgb2JqLl9fcmVhbF9wcmltaXRpdmVfdmFsdWUgPSBbXTtcbiAgICAgICAgICBvYmpbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICB3aGlsZSAoaSA8IDUpIHtcbiAgICAgICAgICAgICAgbGV0IG9wcyA9IGRlZXBDbG9uZShhcHBsaWVkT3BlcmF0aW9ucyk7XG4gICAgICAgICAgICAgIG9wcy5wdXNoKHsndHlwZSc6ICdpdGVyYXRvcicsICdhY2Nlc3NlZF9lbGVtJzogaSsrfSk7XG4gICAgICAgICAgICAgIHlpZWxkIG1ha2VQcm94eSh7fSwgaWRlbnRpZmllciwgb3BzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHlpZWxkIHVuZGVmaW5lZFxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5IGluIFN0cmluZy5wcm90b3R5cGUpIHtcbiAgICAgICAgICAvLyBndWVzcyB0aGF0IHRoaXMgc2hvdWxkIGluIGZhY3Qgbm90IGJlIGEgb2JqZWN0IGJ1dCByYXRoZXIgYSBzdHJpbmcuIHRodXMgYWRhcHQgaXQgdG8gYmUgYSBwcmltaXRpdmUgb2JqZWN0LlxuICAgICAgICAgIG9iai5fX2lzX3ByaW1pdGl2ZV92YWx1ZSA9IHRydWU7XG4gICAgICAgICAgb2JqLl9fcmVhbF9wcmltaXRpdmVfdmFsdWUgPSAnJztcbiAgICAgICAgfSBlbHNlIGlmIChrZXkgaW4gTnVtYmVyLnByb3RvdHlwZSkge1xuICAgICAgICAgIC8vIGd1ZXNzIHRoYXQgdGhpcyBzaG91bGQgaW4gZmFjdCBub3QgYmUgYSBvYmplY3QgYnV0IHJhdGhlciBhIHN0cmluZy4gdGh1cyBhZGFwdCBpdCB0byBiZSBhIHByaW1pdGl2ZSBvYmplY3QuXG4gICAgICAgICAgb2JqLl9faXNfcHJpbWl0aXZlX3ZhbHVlID0gdHJ1ZTtcbiAgICAgICAgICBvYmouX19yZWFsX3ByaW1pdGl2ZV92YWx1ZSA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09ICdfX2lzX3JlYWxfdmFsdWUnKSB7XG4gICAgICAgIHJldHVybiBpc1JlYWxWYWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09ICdfX2dldF9pZGVudGlmaWVyJykge1xuICAgICAgICByZXR1cm4gaWRlbnRpZmllcjtcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09ICdfX2dldF9vcHMnKSB7XG4gICAgICAgIHJldHVybiBhcHBsaWVkT3BlcmF0aW9ucztcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09ICdfX2dldF9yZWFsX29iaicpIHtcbiAgICAgICAgaWYgKHRhcmdldC5fX2lzX3ByaW1pdGl2ZV92YWx1ZSkge1xuICAgICAgICAgIHJldHVybiB0YXJnZXQuX19yZWFsX3ByaW1pdGl2ZV92YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgfVxuICAgICAgaWYgKGtleSA9PT0gJ19faXNfcHJveHknKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzeW1ib2wnKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXRba2V5XTtcbiAgICAgIH1cbiAgICAgIGxldCBhY2Nlc3NlZDtcblxuICAgICAgaWYgKGtleSA9PT0gJ3ZhbHVlT2YnIHx8IGtleSA9PT0gJ3RvU3RyaW5nJyAmJiB0aGlzLl9faXNfcHJpbWl0aXZlX3ZhbHVlKSB7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX19yZWFsX3ByaW1pdGl2ZV92YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGFyZ2V0W1wiX19pc19wcmltaXRpdmVfdmFsdWVcIl0pIHtcbiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0W1wiX19yZWFsX3ByaW1pdGl2ZV92YWx1ZVwiXTtcbiAgICAgICAgYWNjZXNzZWQgPSB0YXJnZXRba2V5XTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWNjZXNzZWQgPSBSZWZsZWN0LmdldCh0YXJnZXQsIGtleSwgcmVjZWl2ZXIpO1xuICAgICAgfVxuXG4gICAgICAvL2lmIChhY2Nlc3NlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIC8vfVxuICAgICAgLy8gVE9ETzogY2hlY2sgaWYgYWNjZXNzZWQgaXMgdW5kZWZpbmVkIGFuZCBoYW5kbGUgdGhpcyBhcHByb3ByaWF0ZWx5XG5cbiAgICAgIC8vIFdlIG5lZWQgdGhpcyBmb3IgaW1wbGljaXQgY29udmVyc2lvbiwgZS5nLiB3aGVuID09IGlzIHVzZWQgYW5kIHR5cGVzIG1pc3NtYXRjaCBzaW5jZSBvdXIgdmFsdWVzIHdpbGwgYWx3YXlzIGJlIHByb3hpZXMgYW5kIGRvZXMgcHJvdm9rZSBpbXBsaWNpdCBjb252ZXJzaW9ucy5cbiAgICAgIC8vIEhvd2V2ZXIgd2UgZG8gbm90IHdhbnQgdG8gbG9vc2UgcHJlY2lzaW9uLCB3aGVuIHRvU3RyaW5nIGlzIGNhbGxlZCBieSB0aGUgZGV2ZWxvcGVyIHdoaWNoIGlzIHdoeSB3ZSByZXRhaW50IGl0IGFmdGVyIGEgZnVuY3Rpb24gY2FsbCB0byB0b1N0cmluZyBvciB2YWx1ZU9mXG4gICAgICBpZiAoa2V5ID09PSAndmFsdWVPZicgfHwga2V5ID09PSAndG9TdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLyppZ25vcmVfdGhpc19mdW5jKi9cbiAgICAgICAgICByZXR1cm4gYWNjZXNzZWQuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGFjY2Vzc2VkID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFjY2Vzc2VkLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gdGhpcyBpcyB0aGUgY2FzZSB3aGVuIHdlIHJldHJpZXZlIGEgcHJvcGVydHksIHdlIHdhbnQgdG8gbm90ZSB0aGF0IHdlIGFyZSBub3cgYWNjZXNzaW5nIGEgc3ViIHByb3BlcnR5IGFuZFxuICAgICAgICAvLyBpZiAoYWNjZXNzZWQgPT09IHVuZGVmaW5lZCAmJiBpZGVudGlmaWVyID09PSAnZXZlbnQnKSB7XG4gICAgICAgIC8vICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICAvLyB9XG4gICAgICAgIGlmIChhY2Nlc3NlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGFyZ2V0W2tleV0gPSB7fTtcbiAgICAgICAgICBhY2Nlc3NlZCA9IHRhcmdldFtrZXldO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1Byb3h5KGFjY2Vzc2VkKSkge1xuICAgICAgICAgIHJldHVybiBhY2Nlc3NlZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWFrZVByb3h5KGFjY2Vzc2VkLCBpZGVudGlmaWVyICsgJy4nICsga2V5LnRvU3RyaW5nKCksIFt7XG4gICAgICAgICAgdHlwZTogJ29wc19vbl9wYXJlbnRfZWxlbWVudCcsXG4gICAgICAgICAgb2xkX2lkZW50aWZpZXI6IGlkZW50aWZpZXIsXG4gICAgICAgICAgb2xkX29wczogZGVlcENsb25lKGFwcGxpZWRPcGVyYXRpb25zKVxuICAgICAgICB9XSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHNldDogZnVuY3Rpb24gKHRhcmdldCwga2V5LCB2YWx1ZSwgcmVjZWl2ZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdzZXR0aW5nJywga2V5LCAndG8nLCB2YWx1ZSwgJ29uJywgdGFyZ2V0KTtcbiAgICAgIHJldHVybiBSZWZsZWN0LnNldCh0YXJnZXQsIGtleSwgdmFsdWUsIHJlY2VpdmVyKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBuZXcgUHJveHkob2JqLCBoYW5kbGVyKTtcbn1cblxuZnVuY3Rpb24gZGVlcENsb25lTWFwKG1hcCkge1xuICBsZXQgbSA9IG5ldyBNYXAoKTtcblxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBtYXAuZW50cmllcygpKSB7XG4gICAgbS5zZXQoa2V5LCBkZWVwQ2xvbmUodmFsdWUpKTtcbiAgfVxuICByZXR1cm4gbTtcbn1cblxuZnVuY3Rpb24gZGVlcENsb25lKG9iaikge1xuICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTtcbn1cblxuZnVuY3Rpb24gZGVlcENsb25lUHJveHkocHJveHkpIHtcbiAgbGV0IGlkZW50aWZpZXIgPSBwcm94eS5fX2dldF9pZGVudGlmaWVyO1xuICBsZXQgbGFzdF9vcHMgPSBwcm94eS5fX2dldF9vcHM7XG4gIGxldCByZWFsX3ZhbHVlID0gcHJveHkuX19nZXRfcmVhbF9vYmo7XG5cbiAgcmV0dXJuIHtpZGVudGlmaWVyOiBpZGVudGlmaWVyLCBvcHM6IGxhc3Rfb3BzLCB2YWx1ZTogcmVhbF92YWx1ZX1cbn1cblxuZnVuY3Rpb24gcmFuZG9tU3RyaW5nKGxlbmd0aCA9IDIwKSB7XG4gIGNvbnN0IGNoYXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JztcbiAgbGV0IHJlcyA9ICcnO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKVxuICAgIHJlcyArPSBjaGFycy5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcnMubGVuZ3RoKSk7XG4gIHJldHVybiByZXM7XG59XG5cblxuZnVuY3Rpb24gZGVsYXkodGltZW91dCkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBzZXRUaW1lb3V0KHJlc29sdmUsIHRpbWVvdXQpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZGVQcm94aWZ5QXJndW1lbnRzKGFyZ3MpIHtcbiAgbGV0IHJlcztcbiAgaWYgKEFycmF5LmlzQXJyYXkoYXJncykpIHtcbiAgICByZXMgPSBbXTtcbiAgICBmb3IgKGxldCBhcmcgb2YgYXJncykge1xuICAgICAgYXJnID0gZGVQcm94aWZ5QXJndW1lbnRzKGFyZyk7XG4gICAgICByZXMucHVzaChhcmcpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChhcmdzID09PSB1bmRlZmluZWQpIHtcblxuICB9IGVsc2UgaWYgKGlzUHJveHkoYXJncykpIHtcbiAgICByZXMgPSB7b3BzOiBhcmdzLl9fZ2V0X29wcywgaWRlbnRpZmllcjogYXJncy5fX2dldF9pZGVudGlmaWVyfTtcbiAgfSBlbHNlIGlmIChhcmdzLl9fcHJvdG9fXyA9PT0gUmVnRXhwLnByb3RvdHlwZSkge1xuICAgIGxldCByZWdleCA9IGFyZ3MudG9TdHJpbmcoKTtcbiAgICByZXMgPSByZWdleC5zbGljZSgxKS5zbGljZSgwLCByZWdleC5sYXN0SW5kZXhPZignLycpIC0gMSlcbiAgfSBlbHNlIHtcbiAgICByZXMgPSBhcmdzO1xuICB9XG5cbiAgcmV0dXJuIHJlc1xufVxuXG5mdW5jdGlvbiBpc1Byb3h5KG9iaikge1xuICBpZiAob2JqID09PSB3aW5kb3cgfHwgb2JqID09PSBwYXJlbnQgfHwgb2JqID09PSB3aW5kb3cub3BlbmVyKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbiAgcmV0dXJuIG9iaiAhPT0gbnVsbCAmJiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiBvYmouX19pc19wcm94eTtcbn1cblxuZnVuY3Rpb24gZ2V0RnVuY3Rpb25TdHJpbmcoZnVuKSB7XG4gIHJldHVybiAoZnVuY3Rpb24gKCkge1xuICB9KS50b1N0cmluZy5hcHBseShmdW4pO1xufVxuXG5leHBvcnQge1xuICBtYWtlUHJveHksXG4gIGRlZXBDbG9uZSxcbiAgZGVlcENsb25lTWFwLFxuICBkZWVwQ2xvbmVQcm94eSxcbiAgcmFuZG9tU3RyaW5nLFxuICBkZWxheSxcbiAgZGVQcm94aWZ5QXJndW1lbnRzLFxuICBpc1Byb3h5LFxuICBnZXRGdW5jdGlvblN0cmluZ1xufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./util.js\n");

/***/ })

/******/ });